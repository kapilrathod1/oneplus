!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OTrack=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function p(e,t){return g(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||y(e,t)||_()}function h(e){return function(e){if(Array.isArray(e))return w(e)}(e)||m(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){if(Array.isArray(e))return e}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function y(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}function _(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var b,k,T,E={app_id:"",app_key:"",env:"prod",region:"sg",session_cutting_time:30,sdk_auto_track:!0,is_single_page_app:!0,is_track_visittime:!0,log_level:"info",reported_platforms:["web"],pageview:{delay:10,track_pageview_type:"auto",track_ignore:function(){return!1},is_trigger_pageload:!0,url_alias:{}},exposure:{once:!0,duration_threshold:300,intersection_threshold:1,root_margin:"0px"},develop:{catch_js_error:!1,performance:!1},app_version:"",is_cross_subdomain:!1,is_print_header:!1,event_rule:[],event_blacklist:[]},S={balance:!0,flush:!0,is_print_header:!1,interval_time:1,max_batch_events:3,fail_timeout:30,fail_retry_count:1};!function(e){e[e.INIT=0]="INIT",e[e.FETCH_CONFIG=1]="FETCH_CONFIG",e[e.READY=2]="READY"}(b||(b={})),function(e){e.TRACK="track",e.DEFERRED="deferred",e.REQUEST="request",e.TRACK_PENDING="track-pending"}(k||(k={})),function(e){e.BALANCE="balance",e.BALANCE_REQ="balance_req"}(T||(T={}));var C,O=[k.TRACK],I={eventId:"$page_view",eventGroup:"$track_page_view"},A={eventId:"$page_duration",eventGroup:"$track_page_view"},x={eventId:"$catch_error",eventGroup:"$track_develop"},D={clickId:"$web_click",stayId:"$web_stay",eventGroup:"$track_heatmap"};!function(e){e.DOMESTIC="https://static-common.heytapdownload.com",e.FOREIGN="https://static-common.heytapdl.com",e.INTRANET="https://static-common.oppoer.me",e.FILES_COMMON="common-files"}(C||(C={}));var L=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},N=Object.prototype.toString,j=function(e){return null!=e&&"[object Object]"==N.call(e)},P=function(e){return"[object Date]"==N.call(e)},M=function(e){return Array.isArray&&Array.isArray(e)||"[object Array]"===N.call(e)},R=function(e){return"[object Function]"==N.call(e)},U=function(e){return N.call(e).slice(8,-1)},$={addEvent:function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)},removeEvent:function(e,t,n){e&&(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null)}};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t,n){return t&&W(e.prototype,t),n&&W(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||J(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||J(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var Y=!0,Z="info",ee={debug:0,info:10,warn:100,error:1e3};function te(e){try{return JSON.stringify(e,null,"  ")}catch(t){return JSON.stringify(e)}}var ne=function(e){return["string","number","boolean","undefined","null"].indexOf(q(e))>-1},re=function(){function e(t){G(this,e),this.namespace="",this.isShowMills=!1,this.isShowLog=!0,this.info=this.genLog("info"),this.warn=this.genLog("warn"),this.error=this.genLog("error"),this.debug=this.genLog("debug"),t&&this.setLogConfig(t)}return V(e,[{key:"setLogConfig",value:function(e){var t=e.isShowLog,n=e.isShowMills,r=void 0!==n&&n,i=e.namespace,o=void 0===i?"":i;this.isShowLog=void 0===t||t,this.isShowMills=r,this.namespace=o}},{key:"config",get:function(){return{namespace:this.namespace,isShowMills:this.isShowMills,isShowLog:this.isShowLog}}},{key:"clone",value:function(t){return new e(F(F({},this.config),t))}},{key:"genLog",value:function(e){var t=this;return function(){var n="__otrack_debug",r=!1;try{var i;r=JSON.parse((null===(i=localStorage)||void 0===i?void 0:i.getItem(n))||"false")}catch(e){}if(r&&(Y=!0),!(Y&&t.isShowLog||-1!==["warn","error"].indexOf(e)))return!1;if(ee[Z]>ee[e])return!1;for(var o=arguments.length,a=Array(o),s=0;o>s;s++)a[s]=arguments[s];var c=a.map((function(e,t,n){return j(e)?te(e):M(e)?e.every((function(e){return ne(e)||M(e)}))?e:te(e):ne(e)&&t!==n.length-1?e+"":e})),u=new Date;""!==t.namespace&&c.unshift(t.namespace),c.unshift("".concat(L(u,"yyyy-MM-dd hh:mm:ss"+(t.isShowMills?".S":""))));var l=c.filter((function(e){return""!==e}));if("object"===(void 0===console?"undefined":q(console))&&console[e])try{return console[e].call(console,l.join(", "))}catch(t){console[e](l[0])}}}}]),e}();re.disableAllLog=function(){Y=!1,re.disableAllLog=function(){}},re.setLogLevel=function(e){["info","debug","error","warn"].includes(e)&&(Z=e)};var ie=new re,oe="0123456789",ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",se="~!@#$%^*()_+-=[]{}|;:,./<>?";
/**
   * @copyright Maichong Software Ltd. 2016 http://maichong.it
   * @date 2016-01-20
   * @author Liang <liang@maichong.it>
   */function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{specials:!1,letters:!0,numbers:!0};e||(e=8),t||(t={});var n="",r="";for(!0===t?n=oe+ae+se:"string"==typeof t?n=t:(!1!==t.numbers&&(n+="string"==typeof t.numbers?t.numbers:oe),!1!==t.letters&&(n+="string"==typeof t.letters?t.letters:ae),t.specials&&(n+="string"==typeof t.specials?t.specials:se));e>0;)e--,r+=n[Math.floor(Math.random()*n.length)];return r}var ue=ce(8);function le(e){for(var t={},n=[],r=0;e.length>r;r++){var i=e[r];t.hasOwnProperty(i)?t[i]=!0:(t[i]=!1,n.push(e[r]))}return n}function fe(e){return JSON.stringify(e)}function de(e){if(null==e)return e;try{e=JSON.parse(e)}catch(e){}return e}function ve(e,t,n,r){r=F({cross_subdomain:!1,domain:""},r);var i=new Date,o=0;"number"==typeof n?o=i.getTime()+24*n*60*60*1e3:P(n)&&(o=n.getTime()),i.setTime(o);var a="; expires="+i.toUTCString();r.cross_subdomain&&(r.domain=function(e){var t;if(!(e=e||(null===(t=location)||void 0===t?void 0:t.hostname)))return"";var n=e.split(".");if(M(n)&&n.length>=2&&!/^(\d+\.)+\d+$/.test(e))for(var r="."+n.splice(n.length-1,1);n.length>0;)if(r="."+n.splice(n.length-1,1)+r,document.cookie="otrack_jssdk_domain_test=true; path=/; domain="+r,-1!==document.cookie.indexOf("otrack_jssdk_domain_test=true")){var i=new Date;return i.setTime(i.getTime()-1e3),document.cookie="otrack_jssdk_domain_test=true; expires="+i.toUTCString()+"; path=/; domain="+r,r}return""}()),document.cookie=e+"="+t+a+"; path=/"+(r.domain?"; domain="+r.domain:"")}function pe(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function he(e){for(var t=e+"=",n=document.cookie.split(";"),r=0,i=n.length;i>r;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}var ge=!0;try{"undefined"!=typeof localStorage&&(localStorage.setItem("testLocal","true"),localStorage.removeItem("testLocal"))}catch(Ht){ie.warn("localStorage不支持",Ht),ge=!1}function me(e,t,n){var r,i;if(e.indexOf("-queue")>0&&(e="".concat(e,"/").concat(ue)),n=void 0===n||n,null!=t)if(t=fe(t),ge)try{var o;null===(o=localStorage)||void 0===o||o.setItem(e,t)}catch(e){if(["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError","W3CException_DOM_QUOTA_EXCEEDED_ERR"].indexOf(e.name)>-1){try{for(var a=0;a<(null===(s=localStorage)||void 0===s?void 0:s.length);a++){var s,c,u=null===(c=localStorage)||void 0===c?void 0:c.key(a);if(u&&/^obus-track_/.test(u))if(-1===u.indexOf("track-queue")&&-1===u.indexOf("request-queue")){var l;null===(l=localStorage)||void 0===l||l.removeItem(u)}else{var f,d,v=(null===(f=localStorage)||void 0===f?void 0:f.getItem(u))||[];null===(d=localStorage)||void 0===d||d.setItem(u,fe({version:Date.now(),data:v.length>100?v.slice(100-v.length):v}))}}}catch(e){}return}console.log("[OTrack] setStorage error")}else n||ve(e,t,30);if(void 0===t){var p;if(ge)r=null===(p=localStorage)||void 0===p?void 0:p.getItem(e);else n||(r=he(e));return de(r)}null===t&&(ge?null===(i=localStorage)||void 0===i||i.removeItem(e):n||ve(e,"",-1))}var ye=!0;try{"undefined"!=typeof sessionStorage&&(sessionStorage.setItem("testLocal","true"),sessionStorage.removeItem("testLocal"))}catch(Ht){ie.warn("sessionStorage不支持",Ht),ye=!1}function we(e,t,n){var r;if(n=void 0===n||n,null!=t)if(t=fe(t),ye)try{sessionStorage.setItem(e,t)}catch(e){console.log("[OTrack] sessionStorage error")}else n||ve(e,t,30);if(void 0===t)return ye?r=sessionStorage.getItem(e):n||(r=he(e)),de(r);null===t&&(ye?sessionStorage.removeItem(e):n||ve(e,"",-1))}function _e(e){var t=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}));return e&&e>0?n.slice(0,e):n}function be(){return Math.floor((new Date).getTime()/1e3)}function ke(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&t(e[r],r,e)&&(n[r]=e[r]);return n}var Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ee=function(e,t){var n,r=this;return function(){for(var i=arguments.length,o=Array(i),a=0;i>a;a++)o[a]=arguments[a];var s=arguments;clearTimeout(n),n=window.setTimeout((function(){e.apply(r,s)}),t)}};function Se(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}!function(){var e=we("LIFEID");e?ue=e:we("LIFEID",ue);try{for(var t=0;t<localStorage.length;t++){var n=localStorage.key(t);if(n&&/^obus-track_/.test(n)){var r=localStorage.getItem(n),i=Date.now(),o=(r=de(r)||{version:0}).version;o&&i-o>864e5&&localStorage.removeItem(n)}}}catch(e){}}();var Ce=!0;function Oe(e){if(void 0===e)return Ce;Ce=e}function Ie(e,t){var n,r,i=t.method,o=void 0===i?"GET":i,a=t.data,s=void 0===a?{}:a,c=t.timeout,u=void 0===c?20:c,l=!("onLine"in(navigator||{}))||(null===(n=navigator)||void 0===n?void 0:n.onLine),f=t.success,d=t.fail;u=u||20;var v=function(n){if(void 0===t.reTryCount||0>=t.reTryCount)return"function"==typeof n&&n(!0),!0;t.success=f,t.fail=d,ie.warn("retry fetch with ".concat(--t.reTryCount," count.")),Ie(e,t)},p=function(){var e=window;if(void 0!==e.XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return ie.error(e),null}}}(),h=Oe();if(t.withCredentials&&(p.withCredentials=t.withCredentials),o=o.toUpperCase(),null==p)return ie.error("xhr object is null, exiting"),!1;if(!l)return ie.warn("当前网络离线，请检查网络状态!"),t.fail&&t.fail("NOT ONLINE",404),!1;if(t.success=function(e){f&&f(e),r&&(clearTimeout(r),r=0)},t.fail=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];v((function(e){d&&d.apply(null,t)})),r&&(clearTimeout(r),r=0)},r=window.setTimeout((function(){!function(){try{j(p)&&p.abort()}catch(e){ie.error(e)}r&&(clearTimeout(r),r=0,t.fail&&t.fail("TIMEOUT",408),p.onreadystatechange=null,p.onload=null,p.onerror=null)}()}),1e3*u),p.onreadystatechange=function(){try{4==p.readyState&&(p.status>=200&&300>p.status||304==p.status?t.success&&t.success(function(e){if(!e)return"";try{return JSON.parse(e)}catch(e){return{}}}(p.responseText)):t.fail&&t.fail(p.responseText,p.status),p.onreadystatechange=null,p.onload=null)}catch(e){console.error(e),p.onreadystatechange=null,p.onload=null}},"GET"===o.toUpperCase()){var g=function(e){if(e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}(s)?"?"+pe(s):"";p.open("GET",e+g,h)}else p.open("POST",e,h);if(j(t.headers))for(var m in t.headers)t.headers.hasOwnProperty(m)&&p.setRequestHeader&&p.setRequestHeader(m,t.headers[m]);if("GET"===o)return p.send(),!0;var y,w=t.headers&&(t.headers["Content-Type"]||t.headers["Content-type"])||"";if(0>w.indexOf("application/x-www-form-urlencoded"))0>w.indexOf("application/json")?p.send(s):p.send(JSON.stringify(s));else if((null===(y=navigator)||void 0===y?void 0:y.sendBeacon)&&!h){var _=new URLSearchParams;Object.keys(s).forEach((function(e){_.append(e,s[e])})),navigator.sendBeacon(e,_)}else p.send(pe(s))}var Ae={AT:"EU",BE:"EU",DK:"EU",FI:"EU",FR:"EU",DE:"EU",GR:"EU",IE:"EU",IT:"EU",LU:"EU",NL:"EU",PT:"EU",ES:"EU",SE:"EU",GB:"EU",HU:"EU",PL:"EU",CZ:"EU",SI:"EU",SK:"EU",EE:"EU",LT:"EU",MT:"EU",CY:"EU",RO:"EU",BG:"EU",LV:"EU",HR:"EU",NO:"EU",IS:"EU",LI:"EU",CH:"EU",TR:"EU",RS:"EU",BA:"EU",MX:"US"},xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch((e=(e||"").toUpperCase()).toUpperCase()){case"EU":case"CN":case"SG":case"IN":return e;case"SGP":case"":return"SG";case"US":return"US";default:return Ae[e]||"SG"}},De=function(){var e,t,n=null===(e=navigator)||void 0===e||null===(t=e.userAgent)||void 0===t?void 0:t.toLowerCase(),r=function(e){return e&&(n=(e+"").toLowerCase()),/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(n)?"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(n)?"mobile":"desktop"};return{device:r(),detect:r,isMobile:"desktop"!==r(),userAgent:n}}();function Le(){var e=document;return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function Ne(){var e=document;return Math.min(Math.min(e.body.clientHeight,e.documentElement.clientHeight),Math.min(e.body.offsetHeight,e.documentElement.offsetHeight),window.innerHeight)}function je(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}var Pe={ucbrowser:"UC",sogou:"Sogou","2345browser":"2345",baidu:"Baidu",liebao:"LieBao",huawei:"Huawei",360:360,heytap:"oppo",oppo:"oppo",quark:"quark",vivo:"vivo",meizu:"meizu",samsung:"samsung"},Me=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.match(t);return r?r[n]:"0"};var Re,Ue,$e,He,Fe=function(){var e,t,n,r;if("object"!==("undefined"==typeof __wxConfig?"undefined":q(__wxConfig))){var i=window||Object.create(null),o=(null===(e=navigator)||void 0===e||null===(t=e.userAgent)||void 0===t?void 0:t.toLowerCase())||"",a={type:"",versions:""},s={IE:i.ActiveXObject||"ActiveXObject"in i,Chrome:o.indexOf("chrome")>-1&&o.indexOf("safari")>-1,Firefox:o.indexOf("firefox")>-1,Opera:!!i.opr&&!!i.opr.addons||!!i.opera||-1!==(null===(n=navigator)||void 0===n||null===(r=n.userAgent)||void 0===r?void 0:r.indexOf("OPR/")),Safari:o.indexOf("safari")>-1&&-1==o.indexOf("chrome"),Edge:o.indexOf("edge")>-1,QQBrowser:/qqbrowser/i.test(o),WeixinBrowser:/MicroMessenger/i.test(o),QQInnerBrowser:/QQ\//i.test(o),WeiboInnerBrowser:/weibo/i.test(o)};for(var c in s)if(s[c]){var u="";if("IE"==c)u=Me(o,/(msie\s|trident.*rv:)([\w.]+)/,2);else if("Chrome"==c){for(var l in navigator.mimeTypes)"application/360softmgrplugin"==navigator.mimeTypes[l].type&&(c="360");var f=o.toLowerCase().match(/(ucbrowser|sogou|2345browser|baidu|huawei|360|heytap|oppo|quark|vivo|meizu|samsung)/gi);f&&(c=Pe[f[0]]||"Chrome"),u=Me(o,/chrome\/([\d.]+)/,1)}else"Firefox"==c?u=Me(o,/firefox\/([\d.]+)/,1):"Opera"==c?u=Me(o,/(?:opera|opr)\/([\d.]+)/,1):"Safari"==c?u=Me(o,/version\/([\d.]+)/,1):"Edge"==c?u=Me(o,/edge\/([\d.]+)/,1):"QQBrowser"==c?u=Me(o,/qqbrowser\/([\d.]+)/,1):"WeixinBrowser"==c?u=Me(o,/MicroMessenger\/([\d.]+)/,1):"QQInnerBrowser"==c?u=Me(o,/QQ\/([\d.]+)/,1):"WeiboInnerBrowser"==c&&(u=Me(o,/__weibo__([\d.]+)/,1));a.type=c,a.versions=parseInt(u,10)}return a}console.log("wx",__wxConfig,"__wxConfig")}(),qe=function(){var e,t,n,r,i,o,a,s,c,u,l,f,d=(null===(e=navigator)||void 0===e?void 0:e.userAgent)||"",v="Win32"==(null===(t=navigator)||void 0===t?void 0:t.platform)||"Windows"==(null===(n=navigator)||void 0===n?void 0:n.platform),p="Mac68K"==(null===(r=navigator)||void 0===r?void 0:r.platform)||"MacPPC"==(null===(i=navigator)||void 0===i?void 0:i.platform)||"Macintosh"==(null===(o=navigator)||void 0===o?void 0:o.platform)||"MacIntel"==(null===(a=navigator)||void 0===a?void 0:a.platform);if(p)return"Mac";if((null===(s=navigator)||void 0===s?void 0:s.platform)&&"iphone"==(null===(c=navigator)||void 0===c?void 0:c.platform.toLowerCase()))return"iPhone";if("X11"==(null===(u=navigator)||void 0===u?void 0:u.platform)&&!v&&!p)return"Unix";var h=((null===(l=navigator)||void 0===l?void 0:l.platform)+"").indexOf("Linux")>-1,g=null==d||null===(f=d.toLowerCase())||void 0===f?void 0:f.match(/android/i);if(h)return g?"Android":"Linux";if(v){if(d.indexOf("Windows NT 5.0")>-1||d.indexOf("Windows 2000")>-1)return"Win2000";if(d.indexOf("Windows NT 5.1")>-1||d.indexOf("Windows XP")>-1||d.indexOf("Windows XP")>-1)return"WinXP";if(d.indexOf("Windows NT 5.2")>-1||d.indexOf("Windows 2003")>-1)return"Win2003";if(d.indexOf("Windows NT 6.0")>-1||d.indexOf("Windows Vista")>-1)return"WinVista";if(d.indexOf("Windows NT 6.1")>-1||d.indexOf("Windows 7")>-1)return"Win7";if(d.indexOf("Windows NT 6.2")>-1||d.indexOf("Windows 8")>-1)return"Win8";if(d.indexOf("Windows NT 10.0")>-1||d.indexOf("Windows 10")>-1)return"Win10"}return"Others"}(),Ge=["callback"],We=function(){function e(t){G(this,e),this.cacheMap={},this.timeout=0,this.pendingImgs=[],this.timeout=t||3e3}return V(e,[{key:"pong",value:function(e){var t=this;if(this.cacheMap[e.key])return!1;var n=function(){t.cacheMap[e.key]&&(clearTimeout(t.cacheMap[e.key]),r.src="",delete t.cacheMap[e.key],t.pendingImgs=t.pendingImgs.filter((function(t){return t.alt!==e.key})))},r=new Image,i=e.callback||function(e,t){};r.onload=function(){i(!0,!0),n()},r.onerror=function(){i(!0,!1),n()},r.alt=e.key,this.cacheMap[e.key]=window.setTimeout((function(){i(!1,"timeout"),n()}),this.timeout),r.src=e.url+"/favicon.ico?v="+ +new Date,this.pendingImgs.push(r)}},{key:"stopLoadImgs",value:function(){this.pendingImgs.forEach((function(e){e.src=""}))}}],[{key:"racePong",value:function(t,n){var r=new e,i=t.length,o=!1,a=setTimeout((function(){o=!0,n(null)}),3e3),s=function(e,t){o||t&&(n(F(F({},e),{},{connection:t})),r.stopLoadImgs(),o=!0,clearTimeout(a)),0==--i&&(clearTimeout(a),!o&&n(null))};t.forEach((function(e){var t=Q(e,Ge);r.pong(F(F({},e),{},{callback:function(e,n){s(t,!!e&&n)}}))}))}}]),e}(),Ve=function(){function e(t){G(this,e);var n=me("is_virtual_env")||"",r=K(n.split("|"),2)[1];t&&(""===n||r&&Date.now()-+r>864e6)&&this.refreshEnv()}return V(e,[{key:"isInCloud",value:function(){var e=me("is_virtual_env");return null==e&&(e=this.isNotVirtual()?"false":"true"),"true"===e.split("|")[0]}},{key:"refreshEnv",value:function(){this.isNotVirtual()||We.racePong([{key:"gitlab",url:"http://gitlab.os.adc.com"}],(function(e){me("is_virtual_env","".concat(!(!e||"gitlab"!==e.key||!e.connection),"|",Date.now()))}))}},{key:"isNotVirtual",value:function(){return-1===qe.toLowerCase().indexOf("win")||1240>screen.width}}]),e}();function Be(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return Xe(!0===t[0],!1,t)}function Qe(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return Xe(!0===t[0],!0,t)}function Ke(e){if(Array.isArray(e)){for(var t=[],n=0;e.length>n;++n)t.push(Ke(e[n]));return t}if(ze(e)){var r={};for(var i in e)r[i]=Ke(e[i]);return r}return e}function ze(e){return e&&"object"===q(e)&&!Array.isArray(e)}function Je(e,t){if(!ze(e))return t;for(var n in t)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(e[n]=ze(e[n])&&ze(t[n])?Je(e[n],t[n]):t[n]);return e}function Xe(e,t,n){var r;!e&&ze(r=n.shift())||(r={});for(var i=0;n.length>i;++i){var o=n[i];if(ze(o))for(var a in o)if("__proto__"!==a&&"constructor"!==a&&"prototype"!==a){var s=e?Ke(o[a]):o[a];r[a]=t?Je(r[a],s):s}}return r}var Ye,Ze,et=function(){var e,t,n;return{origin:null===(e=location)||void 0===e?void 0:e.origin,pathname:null===(t=location)||void 0===t?void 0:t.pathname,href:null===(n=location)||void 0===n?void 0:n.href}},tt=null,nt=et(),rt=null,it=nt,ot="",at=!1,st=function(e){return"function"==typeof e},ct=null===(Re=window)||void 0===Re||null===(Ue=Re.history)||void 0===Ue?void 0:Ue.pushState,ut=null===($e=window)||void 0===$e||null===(He=$e.history)||void 0===He?void 0:He.replaceState;function lt(e,t){var n,r,i=function(){t(location,tt)||e(location,tt)},o=!0,a=function(){var e;if(o=!o){var n=history.__proto__.pushState;n.apply(history,arguments)}else{ot="pushState",it=tt=et();var r=Ye||ct;Ye=null,r.apply(null===(e=window)||void 0===e?void 0:e.history,arguments),nt=et(),o=!0,i(),at?at=!1:t(nt,tt)||ft.watchRoutes().forEach((function(e){return e(nt,tt)}))}},s=function(){var e;if(o=!o){var n=history.__proto__.replaceState;n.apply(history,arguments)}else{ot="replaceState",it=tt=et();var r=Ze||ut;Ze=null,r.apply(null===(e=window)||void 0===e?void 0:e.history,arguments),nt=et(),o=!0,i(),at?at=!1:t(nt,tt)||ft.watchRoutes().forEach((function(e){return e(nt,tt)}))}},c=function(){(tt=nt)||rt||(at=!0),rt=nt,ot||(tt=rt),ot="",nt=it=et(),i(),at?at=!1:t(it,rt)||ft.watchRoutes().forEach((function(e){return e(it,rt)}))};st(ct)&&(window.history.pushState=a),st(ut)&&(window.history.replaceState=s),r=(null===(n=window)||void 0===n?void 0:n.document.documentMode)?"hashchange":ct?"popstate":"hashchange",$.addEvent(window,r,c);setTimeout((function e(){var t,n=!1,i=(null===(t=window)||void 0===t?void 0:t.history)||{};st(ct)&&i.pushState!==a&&(Ye=i.pushState,n=!0),st(ut)&&i.replaceState!==s&&(Ze=i.replaceState,n=!0),n&&($.removeEvent(window,r,c),$.addEvent(window,r,c)),setTimeout(e,1e3)}),1e3)}var ft=function(){function e(){G(this,e)}return V(e,null,[{key:"init",value:function(e,t,n){var r=this;if(this.inited)throw Error("TrackUrlListener重复初始化!");return this.listeners="function"==typeof t?[t]:z(this.listeners),this.isSingleApp=e,e&&lt((function(e,t){r.listeners.forEach((function(n){n(e,t)}))}),n),this.inited=!0,this}},{key:"push",value:function(e){e&&this.listeners.push(e)}},{key:"remove",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"getPrevUrl",value:function(){return this.isSingleApp&&tt?tt.href:document.referrer||""}},{key:"watchRoutes",value:function(e){return void 0!==e&&(this.routerListeners=e),this.routerListeners}}]),e}();ft.listeners=[],ft.routerListeners=[],ft.isSingleApp=void 0,ft.inited=void 0;var dt=function(e){return"object"===n(e)&&(e=JSON.stringify(e)),function(e){for(var t,n,r,i,o="",a=0,s=(e+="").length%3;e.length>a;)((n=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)&&console.log("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range."),o+=Te.charAt((t=n<<16|r<<8|i)>>18&63)+Te.charAt(t>>12&63)+Te.charAt(t>>6&63)+Te.charAt(63&t);return s?o.slice(0,s-3)+"===".substring(s):o}(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},vt=function(e){var t,n,r={domestic:"".concat(C.DOMESTIC,"/").concat(C.FILES_COMMON,"/").concat(e),foreign:"".concat(C.FOREIGN,"/").concat(C.FILES_COMMON,"/").concat(e),intranet:"".concat(C.INTRANET,"/").concat(C.FILES_COMMON,"/").concat(e)},i=new Ve((n=(null===(t=location)||void 0===t?void 0:t.hostname)||"",!!(/\.example$/.test(n)||"localhost"===n||/\.wanyol\.com$/.test(n)||-1!==n.indexOf("test")||-1!==n.indexOf("dev")||/^\d+(?:.\d+){3}$/.test(n))));return"zh-CN"===navigator.language?i.isInCloud()?r.intranet:r.domestic:i.isInCloud()?r.intranet:r.foreign},pt=function(e){var t=dt(e);return{data:{data:t,crc:function(e){var t=0;if(0==e.length)return t;for(var n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(t)},headers:{"Content-Type":"application/x-www-form-urlencoded"}}},ht=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"SG";t=t||{};var r=xe(n).toUpperCase(),i=(t["AreaCode_".concat(r)]||"").trim();return e?e[n.toUpperCase()]||e[r]||i:i||"https://obus-sg.dc.heytapmobile.com"},gt=function(e,t,n){return e.replace("$HOST",t).replace("$APPID",n)};function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yt(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){kt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bt(e,t,n){return t&&_t(e.prototype,t),n&&_t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;o.length>r;r++)0>t.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Et(e){return function(e){if(Array.isArray(e))return St(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return St(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var Ct=["config_code"],Ot={dev:"https://dev-appconf.wanyol.com",test:"https://app-conf.wanyol.com",getProdUrl:function(e){return"cn"===e?"https://appconf.heytapdownload.com":"sg"===e||"sgp"===e?"https://appconf-sgp.heytapdl.com":"https://appconf-".concat(e.toLocaleLowerCase(),".heytapdl.com")}},It=function(){function e(t){wt(this,e),this.cloudEnvDetector=null,this.cloudEnvDetector=new Ve(t)}return bt(e,[{key:"checkUpdateUrl",value:function(t){var n;return(null===(n=this.cloudEnvDetector)||void 0===n?void 0:n.isInCloud())?"".concat(e.HOST,"/api/checkUpdate"):t}},{key:"cdnUrl",value:function(t){var n;return(null===(n=this.cloudEnvDetector)||void 0===n?void 0:n.isInCloud())?"".concat(e.HOST,"/api/fetchCdnFile"):t}}]),e}();It.HOST="https://obus-jssdk-cn.heytapmobi.com";var At=function(){function e(t){if(wt(this,e),this.options=void 0,this.configList=[],this.proxyConfigHost=void 0,this.options=yt(yt({},{env:"prod",countryCode:"cn",productId:"",expires:"6h",condition:null}),t),this.options.env=this.options.env||"prod",this.configList=me(this.STORAGE_KEY)||[],this.proxyConfigHost=new It(this.isDebugEnv()),me(this.STORAGE_KEY_NO_USED))try{localStorage.removeItem(this.STORAGE_KEY_NO_USED)}catch(e){}}return bt(e,[{key:"fetch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.isArray(e)?e:[e],o=this.configMap,a=[];i=le(i),r?a=i.map((function(e){return{configCode:e,version:0}})):i.forEach((function(e){o[e]?n.isConfigExpired(o[e])&&a.push({configCode:e,version:o[e].version}):a.push({configCode:e,version:0})}));var s=i.filter((function(e){return a.every((function(t){return e!==t.configCode}))})),c=s.map((function(e){return o[e]}));this.fetchConfig(a,(function(e,r){if(r=(r=r||[]).map((function(e){return yt({name:e.config_code},Tt(e,Ct))})),-1===e)return t&&t.call(n,i.map((function(e){return n.configMap[e]}))),ie.error("fetch config error occur.");ie.debug("拉取配置".concat(r.map((function(e){return e.name})),"成功"),r),1===e&&n.writeStorage(r),t&&t.call(n,[].concat(Et(r),Et(c)))}))}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0,r=this.configList,i=r;t||(i=r.filter((function(t){return e.isConfigExpired(t)}))),this.fetchConfig(i.map((function(e){return{version:e.version,configCode:e.name}})),(function(t,r){if(-1===t)return ie.error("fetch config error occur.");ie.info("刷新应用云控配置成功, 即将刷新页面"),1===t&&(e.writeStorage(r),setTimeout((function(){"function"==typeof n&&n()}),200))}))}},{key:"writeStorage",value:function(e){var t=this,n=[],r={};e.forEach((function(e){r[e.name]=!0,n.push({name:e.name,version:e.version,expire:t.getExpireTime(e.interval_time),created:Date.now(),content:e.content})})),this.configList.forEach((function(e){r[e.name]||n.push(e)})),this.configList=n,me(this.STORAGE_KEY,n)}},{key:"getExpireTime",value:function(e){return Date.now()+this.getExpireTimeMills(e)}},{key:"getExpireTimeMills",value:function(e){var t=this.options.expires||"",n=1;if(""!==(t=t.replace(/^\s+.*?\s+$/,""))&&t.length>=2){var r=t.charAt(t.length-1).toLocaleLowerCase();"d"===r?n=864e5:"h"===r?n=36e5:"m"===r?n=6e4:"s"===r&&(n=1e3)}return t?n*parseInt(t.slice(0,-1),10):1e3*e}},{key:"fetchConfig",value:function(e,t){var n=this,r=this.options,i={itemList:e,productId:r.productId};if(r.condition&&(i.systemCondition=r.condition),!e||Array.isArray(e)&&0===e.length)return t&&t(0,this.configList);ie.debug("拉取云控配置",e.map((function(e){return e.configCode})));var o=this.getCheckUpdateUrl();Ie(this.proxyConfigHost.checkUpdateUrl(o),{data:{body:JSON.stringify(i),url:o},reTryCount:2,success:function(e){if(200==+e.error_code){var r=e.item_list.filter((function(e){return e.version>0&&!!e.url}));if(!r||0===r.length)return ie.warn("合法的配置树为0，请检查配置项名称"),t&&t(-1,null),!1;n.fetchCdnFile(r,(function(e,n){if(e)return ie.info("拉取cdn文件异常"),t&&t(-1,null),!1;t&&t(1,n)}))}},fail:function(){return t&&t(-1,null),ie.error("fetch config error")}})}},{key:"fetchCdnFile",value:function(e,t){var n=this,r=[],i=e.length;e.forEach((function(e){Ie(n.proxyConfigHost.cdnUrl(e.url),{data:{url:e.url},reTryCount:2,success:function(n){i--,r.push(yt(yt({},e),{},{content:n})),0===i&&t&&t(!1,r)},fail:function(){0===i&&t&&t(!1,r)}})}))}},{key:"isConfigExpired",value:function(e){var t=Date.now();return!!e.created&&t-(null==e?void 0:e.created)>=this.getExpireTimeMills(1)||!!e.expire&&t>=(null==e?void 0:e.expire)}},{key:"config",get:function(){return this.configList}},{key:"getCheckUpdateUrl",value:function(){var e=this.options.env||"prod",t=this.options.countryCode||"sg",n="sg";return 0>["dev","test"].indexOf(e)?("prod"===e.toLocaleLowerCase()&&(n=(Ae[t.toUpperCase()]||t).toLocaleLowerCase()),"".concat(Ot.getProdUrl(n),"/js/v2/checkUpdate")):"".concat(Ot[e],"/js/v2/checkUpdate")}},{key:"isDebugEnv",value:function(){var e,t=(null===(e=location)||void 0===e?void 0:e.hostname)||"";return!!(/\.example$/.test(t)||"localhost"===t||/\.wanyol\.com$/.test(t)||-1!==t.indexOf("test")||-1!==t.indexOf("dev")||/^\d+(?:.\d+){3}$/.test(t))}},{key:"configMap",get:function(){for(var e={},t=0;this.configList.length>t;t++)e[this.configList[t].name]=this.configList[t];return e}},{key:"STORAGE_KEY",get:function(){return"__mdp_cloud_config/".concat(this.options.productId,"_").concat(this.options.env)}},{key:"STORAGE_KEY_NO_USED",get:function(){return"__mdp_cloud_config/".concat(this.options.productId)}}],[{key:"multiFetch",value:function(e,t){if("Array"!==Object.prototype.toString.call(e).slice(8,-1))throw Error("参数错误");if(e.forEach((function(e){if("function"!=typeof e)throw Error("参数错误")})),t.timeout=t.timeout||20,1===e.length)return e[0](t.success);var n=e.length,r={},i=setTimeout((function(){n>0&&t.fail&&t.fail(r,e.length-n)}),1e3*t.timeout);e.forEach((function(e){e((function(e){r=yt(yt({},r),{},kt({},this.options.productId,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return e.filter(Boolean).forEach((function(e){var i="function"==typeof t?t(e):t;r[e[i]]?!n&&r[e[i]].push(e):r[e[i]]=n?e:[e]})),r}(e,"name",!0))),0==--n&&(t.success(r),window.clearTimeout(i))}))}))}}]),e}();At.VERSION="1.5.41";var xt={interval_time:[1,0,15],max_batch_events:[3,0,15],fail_timeout:[30,0,90],fail_retry_count:[1,0,3]};function Dt(e,t){for(var n in e)if(e.hasOwnProperty(n)){if("number"!=typeof e[n])continue;var r=+e[n],i=t[n];if(-1===r||void 0===i)continue;"number"==typeof i[0]&&(null==i[1]&&(i[1]=-1/0),void 0===i[2]&&(i[1]=1/0)),(i[1]>r||r>i[2])&&(r=+i[0]),e[n]=r}return e}var Lt=function(e){var t,n,r,i,o;if(function(e,t){ke(e,(function(e,n){return-1===t.indexOf(n)}))}(e,["balance","flush","event_rule","event_blacklist"]),o=Be(!0,e),!e.app_id||!e.app_key)return console.error("app_id, app_key不能为空"),[!1,""];if(e.env&&["test","pre","prod"].includes(e.env)||(o.env="prod"),e.region&&["sg","cn","in","eu","us"].includes(e.region.toLowerCase())||(o.region="sg"),"number"!=typeof e.interval_time||15>=e.interval_time&&e.interval_time>0||(o.interval_time=1),"number"==typeof e.max_batch_events&&(e.max_batch_events>20||0>e.max_batch_events)&&(o.max_batch_events=3),(o.session_cutting_time>150||20>o.session_cutting_time)&&(o.session_cutting_time=30),M(null===(t=e.pageview)||void 0===t?void 0:t.track_ignore)){var a,s=null===(a=e.pageview)||void 0===a?void 0:a.track_ignore;o.pageview.track_ignore=function(e){return 0!==s.length&&-1!==s.indexOf(e.pathname)}}"number"==typeof(null===(n=e.pageview)||void 0===n?void 0:n.delay)&&(null===(r=e.pageview)||void 0===r?void 0:r.delay)>5e3&&0>(null===(i=e.pageview)||void 0===i?void 0:i.delay)&&(e.pageview.delay=10);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{catch_js_error:e,performance:e}};return"boolean"==typeof e.develop&&e.develop?o.develop=c(!0):"boolean"==typeof e.develop||e.develop||(o.develop=c()),o.develop=Be(!0,c(),e.develop),[!0,o]},Nt=function(e){e.event_rule=e.event_rule||[],e.event_blacklist=e.event_blacklist||[];var t=ke(e.business,(function(e){return-1!==e}));return e.business=Dt(t,xt),e},jt=function(e){return Dt(e,xt)},Pt={},Mt=function(e,t){if(e.eventId=e.eventId+"",e.eventGroup=e.eventGroup+"",0===e.eventId.indexOf("$")&&/^\$track_/.test(e.eventGroup))return!1;if(0===t.event_rule.length)return!0;!Pt.white&&t.event_rule&&t.event_rule.forEach((function(e){Pt.white=Pt.white||{},Pt.white["".concat(e.eventId,"|").concat(e.eventGroup)]=!0})),!Pt.black&&t.event_blacklist&&t.event_blacklist.forEach((function(e){var t=e.blackKey;Pt.black=Pt.black||{},(t&&M(t)&&t.length>=0||void 0===t)&&(Pt.black["".concat(e.eventId,"|").concat(e.eventGroup)]=t)}));var n="".concat(e.eventId,"|").concat(e.eventGroup),r=!Pt.white||!Pt.white[n];if(!Pt.black||!t.event_blacklist)return r;var i=Pt.black[n];return!(!Pt.black.hasOwnProperty(n)||void 0!==i)||(i&&i.length>0&&i.forEach((function(t){e.properties.hasOwnProperty(t)&&delete e.properties[t]})),r)},Rt="50351",Ut=function(){function e(){r(this,e)}return o(e,null,[{key:"init",value:function(t,n){var r;this.oTrack=n;var i=p(Lt(t),2),o=i[0],a=i[1];this._conf?ie.warn("基础配置不能重复初始化, 请检查"):o&&"string"!=typeof a?("prod"===a.env&&re.disableAllLog(),a.log_level&&re.setLogLevel(a.log_level),ie.info("当前埋点SDK版本".concat(null===(r=e.pkgInfo)||void 0===r?void 0:r.version,", 当前云控SDK版本").concat("1.5.41")),ie.info("用户配置",t),this._conf=Qe(!0,S,E,a),this.fetchCloudConfig(a)):ie.error(a)}},{key:"fetchCloudConfig",value:function(e){var t,n=this,r=this.pkgInfo.version,i=+r.split(".")[0]>1?+r.split(".")[0]:1,o="TrackGlobalWeb".concat(i),a="BUSINESS_WEB_".concat(e.app_id,"_CONFIG");"pre"!==e.env&&"test"!==e.env||(o="".concat(o,"_").concat(e.env)),this.readyState=b.FETCH_CONFIG,this.cloudGlobalConfig=new At({env:"prod",productId:Rt,countryCode:e.region,expires:"prod"===e.env?"6h":"10m",condition:{regionCode:e.region}});var s=(null===(t=this.cloudGlobalConfig.configMap.TrackGlobalWeb1)||void 0===t?void 0:t.content)||{upload_host:{}};this.uploadHost=ht("",s.upload_host,e.region),this.cloudAppConfig=new At({env:e.env&&"prod"===e.env.toLowerCase()?"prod":"test",productId:"compass_".concat(e.app_id),countryCode:e.region,expires:"prod"===e.env?"3h":"30s",condition:{regionCode:e.region}}),At.multiFetch([function(e){return n.cloudGlobalConfig.fetch([o],e)},function(e){return n.cloudAppConfig.fetch([a],e)}],{success:function(t){var r,i,s,c,u=null===(r=t[50351][o])||void 0===r?void 0:r.content,l=null===(i=t["compass_".concat(e.app_id)][a])||void 0===i?void 0:i.content,f=(null===(s=l)||void 0===s?void 0:s.domain)||"";if(ie.debug("应用ID:"+e.app_id,"全局配置",u),ie.debug("应用ID:"+e.app_id,"应用配置",l),!u)return ie.error("云控配置异常","全球配置不存在, 请联系 80252692, 80346696"),!1;if(!l)return ie.error("云控配置拉取异常","请你先在OBus创建类型为web的应用, 有问题请联系80252692, 80346696"),!1;u=jt(u);var d,v=null===(c=l=Nt(l))||void 0===c?void 0:c.business,p=Qe(!0,S,E,u,e,{appDomain:f,event_rule:l.event_rule,event_blacklist:l.event_blacklist},v),h=me("host")||"";if(""===(d=function(){var e=window.location.host;return e.indexOf("localhost")>=0||e.indexOf(".example")>=0||e.indexOf(".wanyol.com")>=0||/\d+(.\d+)+/.test(e)}()&&""!==h?h:ht(f,p.upload_host,p.region))||!/^https?:\/\//.test(d))return ie.error("云控配置",d,"上报域名不合法, 请联系OBus"),!1;ft.init(p.is_single_page_app,[],p.pageview.track_ignore),n.uploadHost=d,n.readyState=b.READY,p.develop.catch_js_error=!0,n._conf=p,n.consumeListeners(),ie.debug("应用ID:"+p.app_id,"host: ".concat(d),"埋点配置",p)},fail:function(e,t){ie.error("应用ID:"+e.app_id,"拉取云配置失败"),n.readyState=b.INIT}})}},{key:"registerCallbacks",value:function(e){this.isReady()?(this.listeners.push(e),this.consumeListeners()):this.listeners.push(e)}},{key:"setPkgInfo",value:function(e){this.pkgInfo=e}},{key:"getPkgInfo",value:function(){return this.pkgInfo}},{key:"config",get:function(){if(!this._conf)throw Error("配置没有初始化");return this._conf}},{key:"isReady",value:function(){return this.readyState===b.READY}},{key:"consumeListeners",value:function(){var e=this;this.listeners.forEach((function(t){R(t)&&t(e._conf)})),this.listeners=[]}}]),e}();function $t(e){var t=(e.stack||"").replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),n=""+e;return 0>t.indexOf(n)&&(t=n+"@"+t),t}Ut._conf=void 0,Ut.pkgInfo=void 0,Ut.readyState=b.INIT,Ut.cloudGlobalConfig=void 0,Ut.cloudAppConfig=void 0,Ut.listeners=[],Ut.uploadHost="",Ut.oTrack=void 0;var Ht,Ft,qt,Gt,Wt,Vt,Bt,Qt=-1,Kt=function(e){addEventListener("pageshow",(function(t){t.persisted&&(Qt=t.timeStamp,e(t))}),!0)},zt=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},Jt=function(){var e=zt();return e&&e.activationStart||0},Xt=function(e,t){var n=zt(),r="navigate";return 0>Qt?n&&(r=document.prerendering||Jt()>0?"prerender":n.type.replace(/_/g,"-")):r="back-forward-cache",{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},Yt=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){t(e.getEntries())}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},Zt=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},en=function(e,t,n,r){var i,o;return function(a){t.value>=0&&(a||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},tn=-1,nn=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},rn=function(){Zt((function(e){tn=e.timeStamp}),!0)},on=function(){return 0>tn&&(tn=nn(),rn(),Kt((function(){setTimeout((function(){tn=nn(),rn()}),0)}))),{get firstHiddenTime(){return tn}}},an=function(e,t){t=t||{};var n,r=[1800,3e3],i=on(),o=Xt("FCP"),a=function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(c&&c.disconnect(),i.firstHiddenTime>e.startTime&&(o.value=e.startTime-Jt(),o.entries.push(e),n(!0)))}))},s=window.performance&&window.performance.getEntriesByName&&window.performance.getEntriesByName("first-contentful-paint")[0],c=s?null:Yt("paint",a);(s||c)&&(n=en(e,o,r,t.reportAllChanges),s&&a([s]),Kt((function(i){o=Xt("FCP"),n=en(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,n(!0)}))}))})))},sn=!1,cn=-1,un={passive:!0,capture:!0},ln=new Date,fn=function(e,t){Ht||(Ht=t,Ft=e,qt=new Date,pn(removeEventListener),dn())},dn=function(){if(Ft>=0&&qt-ln>Ft){var e={entryType:"first-input",name:Ht.type,target:Ht.target,cancelable:Ht.cancelable,startTime:Ht.timeStamp,processingStart:Ht.timeStamp+Ft};Gt.forEach((function(t){t(e)})),Gt=[]}},vn=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){fn(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,un),removeEventListener("pointercancel",r,un)};addEventListener("pointerup",n,un),addEventListener("pointercancel",r,un)}(t,e):fn(t,e)}},pn=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,vn,un)}))},hn={},gn=function e(t){document.prerendering?addEventListener("prerenderingchange",(function(){return e(t)}),!0):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},mn=function(e,t){t=t||{};var n=[800,1800],r=Xt("TTFB"),i=en(e,r,n,t.reportAllChanges);gn((function(){var o=zt();if(o){if(r.value=Math.max(o.responseStart-Jt(),0),0>r.value||r.value>performance.now())return;r.entries=[o],i(!0),Kt((function(){r=Xt("TTFB",0),(i=en(e,r,n,t.reportAllChanges))(!0)}))}}))};function yn(e){var t,n=function(t){e({eventId:"$track_perf_".concat(t.name.toLocaleLowerCase()),eventGroup:"$track_develop",properties:{value:t.value.toFixed(3)}})};(null===(t=window)||void 0===t?void 0:t.performance)&&Ut.config.develop.performance&&(!function(e,t){t=t||{};var n=[.1,.25];sn||(an((function(e){cn=e.value})),sn=!0);var r,i=function(t){cn>-1&&e(t)},o=Xt("CLS",0),a=0,s=[],c=function(e){e.forEach((function(e){e.hadRecentInput||(a&&1e3>e.startTime-s[s.length-1].startTime&&5e3>e.startTime-s[0].startTime?(a+=e.value,s.push(e)):(a=e.value,s=[e]),a>o.value&&(o.value=a,o.entries=s,r()))}))},u=Yt("layout-shift",c);u&&(r=en(i,o,n,t.reportAllChanges),Zt((function(){c(u.takeRecords()),r(!0)})),Kt((function(){a=0,cn=-1,o=Xt("CLS",0),r=en(i,o,n,t.reportAllChanges)})))}(n),function(e,t){t=t||{};var n,r=[100,300],i=on(),o=Xt("FID"),a=function(e){i.firstHiddenTime>e.startTime&&(o.value=e.processingStart-e.startTime,o.entries.push(e),n(!0))},s=function(e){e.forEach(a)},c=Yt("first-input",s);n=en(e,o,r,t.reportAllChanges),c&&Zt((function(){s(c.takeRecords()),c.disconnect()}),!0),c&&Kt((function(){o=Xt("FID"),n=en(e,o,r,t.reportAllChanges),Gt=[],Ft=-1,Ht=null,pn(addEventListener),Gt.push(a),dn()}))}(n),an(n),function(e,t){t=t||{};var n,r=[2500,4e3],i=on(),o=Xt("LCP"),a=function(e){var t=e[e.length-1];if(t){var r=t.startTime-Jt();i.firstHiddenTime>r&&(o.value=r,o.entries=[t],n())}},s=Yt("largest-contentful-paint",a);if(s){n=en(e,o,r,t.reportAllChanges);var c=function(){hn[o.id]||(a(s.takeRecords()),s.disconnect(),hn[o.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),Zt(c,!0),Kt((function(i){o=Xt("LCP"),n=en(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,hn[o.id]=!0,n(!0)}))}))}))}}(n),mn(n))}function wn(e){return new wn.init(e)}function _n(e,t){return e.indexOf(t)}function bn(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0}function kn(e,t){if("string"==typeof t)return bn(e,t);if(M(t)){for(var n=!1,r=0;t.length>r;r++){if(bn(e,t[r])){n=!0;break}}return n}}function Tn(e){if(!e.target)return!1;var t=e.target,n=t.tagName.toLowerCase(),r={};return r.$element_type=n,r.$element_name=t.getAttribute("name"),r.$element_id=t.getAttribute("id"),r.$element_class_name="string"==typeof t.className?t.className:null,r.$element_target_url=t.getAttribute("href"),r.$element_content=function(e,t){var n="",r="";e.textContent?n=Se(e.textContent):e.innerText&&(n=Se(e.innerText));n&&(n=n.replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255));r=n||"",("input"===t||"INPUT"===t)&&("button"===e.type||"submit"===e.type||Vt&&"function"==typeof Vt.collect_input&&Vt.collect_input(e))&&(r=e.value||"");return r}(t,n),r=function(e){var t={};for(var n in e)null!==e[n]&&(t[n]=e[n]);return t}(r),r}(wn.init=function(e){this.ele=e}).prototype={addClass:function(e){return-1===(" "+this.ele.className+" ").indexOf(" "+e+" ")&&(this.ele.className=this.ele.className+(""===this.ele.className?"":" ")+e),this},removeClass:function(e){var t=" "+this.ele.className+" ";return-1!==t.indexOf(" "+e+" ")&&(this.ele.className=t.replace(" "+e+" "," ").slice(1,-1)),this},hasClass:function(e){return-1!==(" "+this.ele.className+" ").indexOf(" "+e+" ")},attr:function(e,t){return"string"==typeof e&&isUndefined(t)?this.ele.getAttribute(e):("string"==typeof e&&this.ele.setAttribute(e,t+=""),this)},offset:function(){var e=this.ele.getBoundingClientRect();if(e.width||e.height){var t=this.ele.ownerDocument.documentElement;return{top:e.top+window.pageYOffset-t.clientTop,left:e.left+window.pageXOffset-t.clientLeft}}return{top:0,left:0}},getSize:function(){if(!window.getComputedStyle)return{width:this.ele.offsetWidth,height:this.ele.offsetHeight};try{var e=this.ele.getBoundingClientRect();return{width:e.width,height:e.height}}catch(e){return{width:0,height:0}}},getStyle:function(e){return this.ele.currentStyle?this.ele.currentStyle[e]:this.ele.ownerDocument.defaultView.getComputedStyle(this.ele,null).getPropertyValue(e)},wrap:function(e){var t,n=null===(t=document)||void 0===t?void 0:t.createElement(e);return this.ele.parentNode.insertBefore(n,this.ele),n.appendChild(this.ele),wn(n)},getCssStyle:function(e){var t=this.ele.style.getPropertyValue(e);if(t)return t;var n=null;if("function"==typeof window.getMatchedCSSRules&&(n=window.getMatchedCSSRules(this.ele)),!n||!isArray(n))return null;for(var r=n.length-1;r>=0;r--){if(t=n[r].style.getPropertyValue(e))return t}},sibling:function(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e},next:function(){return this.sibling(this.ele,"nextSibling")},prev:function(){return this.sibling(this.ele,"previousSibling")},siblings:function(){return this.siblings((this.ele.parentNode||{}).firstChild,this.ele)},children:function(){return this.siblings(this.ele.firstChild)},parent:function(){var e=this.ele.parentNode;return e=e&&11!==e.nodeType?e:null,wn(e)},previousElementSibling:function(){var e=this.ele;if("previousElementSibling"in document.documentElement)return wn(e.previousElementSibling);for(;e=e.previousSibling;)if(1===e.nodeType)return wn(e);return wn(null)},getSameTypeSiblings:function(){for(var e=this.ele,t=e.parentNode,n=e.tagName.toLowerCase(),r=[],i=0;t.children.length>i;i++){var o=t.children[i];1===o.nodeType&&o.tagName.toLowerCase()===n&&r.push(t.children[i])}return r},getParents:function(){try{var e=this.ele;if(!isElement(e))return[];var t=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)t.push(e=e.parentElement);return t}catch(e){return[]}}};var En={otherTags:[],getTargetElement:function(e,t){var r=e;if("object"!==n(r))return null;if("string"!=typeof r.tagName)return null;var i=r.tagName.toLowerCase();if("body"===i.toLowerCase()||"html"===i.toLowerCase())return null;if(!r||!r.parentNode||!r.parentNode.children)return null;var o=r.parentNode,a=this.hasElement({event:t&&t.originalEvent||t,element:e},(function(e){return"a"===e.tagName.toLowerCase()||kn(e,Vt.track_attr)}));if("a"===i||"button"===i||"input"===i||"textarea"===i)return r;if(_n(this.otherTags,i)>-1)return r;if("button"===o.tagName.toLowerCase()||"a"===o.tagName.toLowerCase())return o;if("area"===i&&"map"===o.tagName.toLowerCase()&&wn(o).prev().tagName&&"img"===wn(o).prev().tagName.toLowerCase())return wn(o).prev();if(a)return a;if("div"===i&&Vt.collect_tags.div&&this.isDivLevelValid(r))return(Vt&&Vt.collect_tags&&Vt.collect_tags.div&&Vt.collect_tags.div.max_level||1)>1||this.isCollectableDiv(r)?r:null;if(this.isStyleTag(i)&&Vt.collect_tags.div){var s=this.getCollectableParent(r);if(s&&this.isDivLevelValid(s))return s}return null},getDivLevels:function(e,t){return En.getElementPath(e,!0,t).split(" > ").filter((function(e){return"div"===e})).length},isDivLevelValid:function(e){for(var t=Vt&&Vt.collect_tags&&Vt.collect_tags.div&&Vt.collect_tags.div.max_level||1,n=e.getElementsByTagName("div"),r=n.length-1;r>=0;r--)if(En.getDivLevels(n[r],e)>t)return!1;return!0},getElementPath:function(e,t,n){for(var r=[];e.parentNode;){if(e.id&&!t&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.id)){r.unshift(e.tagName.toLowerCase()+"#"+e.id);break}if(n&&e===n){r.unshift(e.tagName.toLowerCase());break}if(e===document.body){r.unshift("body");break}r.unshift(e.tagName.toLowerCase()),e=e.parentNode}return r.join(" > ")},getClosestLi:function(e){return function(e,t){for(;e&&e!==document&&1===e.nodeType;e=e.parentNode)if(e.tagName.toLowerCase()===t)return e;return null}(e,"li")},getElementPosition:function(e,t,n){var r=En.getClosestLi(e);if(!r)return null;var i=e.tagName.toLowerCase(),o=r.getElementsByTagName(i),a=o.length,s=[];if(a>1){for(var c=0;a>c;c++){En.getElementPath(o[c],n)===t&&s.push(o[c])}if(s.length>1)return _n(s,e)}return function(e){if(!e.parentNode)return"";if(1===wn(e).getSameTypeSiblings().length)return 0;for(var t=0,n=e;n=wn(n).previousElementSibling().ele;)t++;return t}(r)},getDomIndex:function(e){if(!e.parentNode)return-1;for(var t=0,n=e.tagName,r=e.parentNode.children,i=0;r.length>i;i++)if(r[i].tagName===n){if(e===r[i])return t;t++}return-1},selector:function(e,t){var n=e.parentNode&&9==+e.parentNode.nodeType?-1:this.getDomIndex(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))&&(!Vt||Vt&&"not_use_id"!==Vt.element_selector)&&!t?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~n?":nth-of-types("+(n+1)+")":"")},getDomSelector:function(e,t,n){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var r=e.nodeName.toLowerCase();return e&&"body"!==r&&1===e.nodeType?(t.unshift(this.selector(e,n)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))&&Vt&&"not_use_id"!==Vt.element_selector&&!n?t.join(" > "):this.getDomSelector(e.parentNode,t,n)):(t.unshift("body"),t.join(" > "))},getEleDetail:function(e){var t=this.getDomSelector(e),n=Tn({target:e});n.$element_selector=t||"",n.$element_path=En.getElementPath(e,Vt&&"not_use_id"===Vt.element_selector);var r=En.getElementPosition(e,n.$element_path,Vt&&"not_use_id"===Vt.element_selector);return"number"==typeof r&&(n.$element_position=r),n},start:function(e,t,r,i,o){var a=j(i)?i:{},s=R(o)?o:R(i)?i:void 0;if(!j(Vt)||"default"!==Vt.clickmap)return!1;if(Vt&&Vt.collect_element&&!Vt.collect_element(t))return!1;var c=this.getEleDetail(t);if(En&&Vt.custom_property){var u=Vt.custom_property(t);j(u)&&(c=Qe(!0,c,u))}c=Qe(!0,c,a),"a"===r&&En&&!0===En.isTrackLink?function(e,t,r){function i(e,t,r){var i=null;if((e=e||{}).ele&&(i=e.ele),e.event&&(i=e.target?e.target:e.event.target),r=r||{},!i||"object"!==n(i))return!1;if(!i.href||/^javascript/.test(i.href)||i.target||i.download||i.onclick)return Wt(t,r),!1;function o(e){e.stopPropagation(),e.preventDefault();var n=!1;function o(){n||(n=!0,location.href=i.href)}setTimeout(o,1e3),Wt(t,r,o)}e.event&&o(e.event),e.ele&&$.EventUtils(e.ele,"click",(function(e){o(e)}))}"object"===n(e)&&e.tagName?i({ele:e},t,r):"object"===n(e)&&e.target&&e.event&&i(e,t,r)}({event:e,target:t},D.clickId,c):Wt(D.clickId,c,s)},hasElement:function(e,t){var r;if(e.event){var i=e.event;r=i.path||i._getPath&&i._getPath()}else e.element&&(r=wn(e.element).getParents());if(r&&M(r)&&r.length>0)for(var o=0;r.length>o;o++)if("object"===n(r[o])&&1===r[o].nodeType&&t(r[o]))return r[o]},isStyleTag:function(e,t){return-1>=_n(["a","div","input","button","textarea"],e)&&(!t||Vt&&Vt.collect_tags&&Vt.collect_tags.div?!!(j(En)&&j(Vt.collect_tags)&&j(Vt.collect_tags.div)&&M(Vt.collect_tags.div.ignore_tags)&&_n(Vt.collect_tags.div.ignore_tags,e)>-1):_n(["mark","/mark","strong","b","em","i","u","abbr","ins","del","s","sup"],e)>-1)},isCollectableDiv:function(e,t){try{if(0===e.children.length)return!0;for(var n=0;e.children.length>n;n++)if(1===e.children[n].nodeType){var r=e.children[n].tagName.toLowerCase();if(!("div"===r&&(Vt&&Vt.collect_tags&&Vt.collect_tags.div&&Vt.collect_tags.div.max_level)>1||this.isStyleTag(r,t)))return!1;if(!this.isCollectableDiv(e.children[n],t))return!1}return!0}catch(e){Bt.error(e)}return!1},getCollectableParent:function(e,t){try{var n=e.parentNode,r=n?n.tagName.toLowerCase():"";if("body"===r)return!1;if(r&&"div"===r&&((Vt&&Vt.collect_tags&&Vt.collect_tags.div&&Vt.collect_tags.div.max_level)>1||this.isCollectableDiv(n,t)))return n;if(n&&this.isStyleTag(r,t))return this.getCollectableParent(n,t)}catch(e){Bt.error(e)}return!1},initScrollMap:function(){if(!j(Vt)||"default"!==Vt.scroll_notice_map)return!1;var e=function(e){var t={};return t.timeout=e.timeout||1e3,t.func=e.func,t.hasInit=!1,t.inter=null,t.main=function(e,t){this.func(e,t),this.inter=null},t.current_time=new Date,t.go=function(e){var n={};if(!(Vt&&R(Vt.collect_url)&&Vt.collect_url()))return!1;this.inter||(n.$viewport_position=document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop||0,n.$viewport_position=Math.round(n.$viewport_position)||0,n.$viewport_height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0,n.$viewport_width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,e?t.main(n,!0):this.inter=setTimeout((function(){t.main(n)}),this.timeout))},t}({timeout:1e3,func:function(e,t){var n=document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop||0,r=new Date,i=r-this.current_time;(i>Vt.scroll_delay_time&&n-e.$viewport_position!=0||t)&&(e.event_duration=Math.min(Vt.scroll_event_duration,parseInt(i)/1e3),e.event_duration=0>e.event_duration?0:e.event_duration,Wt(D.stayId,e)),this.current_time=r}});$.addEvent(window,"scroll",(function(){e.go()})),$.addEvent(window,"unload",(function(){e.go("notime")}))},initHeatmap:function(){var e=this;return!(!j(Vt)||"default"!==Vt.clickmap)&&(!(R(Vt.collect_url)&&!Vt.collect_url())&&(Vt.collect_elements="all"===Vt.collect_elements?"all":"interact",void $.addEvent(document,"click","all"===Vt.collect_elements?function(t){var r=t||window.event;if(!r)return!1;var i=r.target||r.srcElement;if("object"!==n(i))return!1;if("string"!=typeof i.tagName)return!1;var o=i.tagName.toLowerCase();if("body"===o||"html"===o)return!1;if(!i||!i.parentNode||!i.parentNode.children)return!1;var a=i.parentNode.tagName.toLowerCase();"a"===a||"button"===a?e.start(r,i.parentNode,a):e.start(r,i,o)}:function(t){var n=t||window.event;if(!n)return!1;var r=e.getTargetElement(n.target||n.srcElement,t);r&&e.start(n,r,r.tagName.toLowerCase())})))}};var Sn={trackHeatMap:function(e,t,r){if("object"===n(e)&&e.tagName){var i=e.tagName.toLowerCase(),o=e.parentNode.tagName.toLowerCase();"button"===i||"a"===i||"a"===o||"button"===o||"input"===i||"textarea"===i||kn(e,Vt&&Vt.track_attr?Vt.track_attr:["data-obus-click"])||En.start(null,e,i,t,r)}},trackAllHeatMap:function(e,t,r){if("object"===n(e)&&e.tagName){var i=e.tagName.toLowerCase();En.start(null,e,i,t,r)}}},Cn=En.getEleDetail.bind(En);function On(e,t,r,i){return e?("string"==typeof r&&n(e[t])!==r&&(e[t]=i),"function"!=typeof r||r(e[t])||(e[t]=i),e):e}function In(e){var t=Be(!0,e),n="default",r="not_collect";for(var i in!0===e&&(t.clickmap=!0,t.scroll_notice_map=!0),"boolean"==typeof t.clickmap&&(t.clickmap=t.clickmap?n:r),On(t,"clickmap",(function(e){return e===n}),r),"boolean"==typeof t.scroll_notice_map&&(t.scroll_notice_map=t.scroll_notice_map?n:r),On(t,"scroll_notice_map",(function(e){return e===n}),r),On(t,"scroll_delay_time","number",4e3),On(t,"scroll_event_duration","number",18e3),On(t,"collect_tags",(function(e){return j(e)}),{}),On(t,"track_attr",(function(e){return M(e)}),["data-obus-click"]),On(t,"collect_url","function",(function(){return!0})),On(t,"collect_element","function",(function(){return!0})),On(t,"track_collect_input","function",(function(){return!1})),On(t,"element_selector",(function(e){return"not_use_id"===e}),""),On(t,"custom_property","function",(function(){return{}})),On(t,"renderRefreshTime","number",1e3),On(t,"loadTimeout","number",1e3),On(t,"get_vtrack_config",(function(e){return!0!==e}),!1),t.track_attr=t.track_attr.filter((function(e){return e&&"string"==typeof e})),!0===t.collect_tags.div&&(t.collect_tags.div={max_level:1,ignore_tags:["mark","/mark","strong","b","em","i","u","abbr","ins","del","s","sup"]}),t.track_attr.push("data-obus-click"),t.collect_tags.div&&t.collect_tags.div.max_level>3&&(t.collect_tags.div.max_level=1),t.collect_tags){"div"!==i&&t.collect_tags[i]&&En.otherTags.push(i)}return t}var An=function(e){var t,n=Qe(!0,e,{heatmap:In(e.heatmap)});return null===(t=e.logger)||void 0===t||t.debug(n.heatmap),function(e){Bt=(e=e||{}).logger||console,Wt=function(t,n,r){var i=e.dispatch;i&&i({eventId:t,eventGroup:D.eventGroup,properties:n}),r&&r()},(Vt=e.heatmap)&&Wt?(En.initHeatmap(),En.initScrollMap()):Bt.error("配置项异常")}(n)},xn=30,Dn=ie.clone({namespace:"DB读写"}),Ln=function(){function e(){r(this,e),this.getVersion=function(){return Date.now()}}return o(e,[{key:"writeTypeStgSafe",value:function(e,t){var n,r,i=0;do{var o=t((n=this.readTypeStg(e)).data);if(!1===o)return n.data;n.data=o||n.data,r=this.readTypeStg(e)}while(r&&n.version!==r.version&&i++<=xn);if(i>xn)console.warn("writeTypeStgSafe try count greater than 30");else if(n.data===r.data&&n.data.length===r.data.length)return r.data||[];return this.writeTypeStg(e,{data:n.data,version:this.getVersion()}),n.data||[]}},{key:"writeTypeStgMultiSafe",value:function(e,t){var n=this,r=0,i=[],o=e.map((function(e){return n.readTypeStg(e)})),a=function(){var t=o&&r++<=xn*e.length;return e.forEach((function(e,n){t=t&&o[n].version!==i[n].version})),t};do{var s=(i=e.map((function(e){return n.readTypeStg(e)}))).map((function(e){return e.data})),c=t.apply(void 0,h(s));if(!1===c)return!1;i=(c=c||s).map((function(e,t){return{version:i[t].version,data:e}})),o=e.map((function(e){return n.readTypeStg(e)}))}while(a());r>xn&&console.warn("writeTypeStgSafe try count greater than 30"),e.forEach((function(e,t){n.writeTypeStg(e,{data:i[t].data,version:n.getVersion()})}))}},{key:"readTypeStg",value:function(e){var t=me(this.getStgQueueName(e)),n=this.getDefValAndType(e);if(n&&U(null==t?void 0:t.data)!==n[0]){var r={data:n[1],version:this.getVersion()};return this.writeTypeStg(e,r),r}return t}},{key:"readStg",value:function(e){return me(e)}},{key:"writeTypeStg",value:function(e,t){var n=this.getDefValAndType(e);return n&&n[0]!==U(null==t?void 0:t.data)?(Dn.error(e,"写入类型".concat(U(null==t?void 0:t.data),"和期待类型").concat(n[0],"不一致")),this.readTypeStg(e),!1):(me(this.getStgQueueName(e),t,!0),!0)}},{key:"writeStg",value:function(e,t){me(e,t,!0)}},{key:"getDefValAndType",value:function(e){return"balance"===e?["Object",{}]:["Array",[]]}},{key:"getStgQueueName",value:function(e){return"obus-track_".concat(Ut.config.app_id,"/").concat(e,"-queue")}}]),e}(),Nn="otrack_jssdk_store",jn=function(){function e(){r(this,e),this.userId="",this.appVersion="",this.customAttrs=null,this.isWebview=!1,this.region="",this.isFirstDay=!1,this.isFirstTime=!1,this.deviceId="",this.initStore();var t=!1;if(he(Nn)){var n=null;try{n=de(function(e){if(!e)return e;var t=atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}));return decodeURIComponent(t.join(""))}(he(Nn))||"null")}catch(e){try{n=de(he(Nn)||"null")}catch(e){ie.error("cookies 设备信息获取失败")}}n&&(this.deviceId=n.deviceId||"",this.userId=n.userId||"",this.isFirstDay=de(he("otrack_jssdk_is_first_day")||"false"),n.deviceId||(this.deviceId=_e(),this.isFirstTime=!0,this.isFirstDay=!0,t=!0))}else""===this.deviceId&&(this.deviceId=_e(),this.isFirstTime=!0,this.isFirstDay=!0,t=!0);if(t){var i=new Date;i.setDate(i.getDate()+1),i.setHours(0,0,0,0),this.writeStore(),ve("otrack_jssdk_is_first_day",fe(this.isFirstDay),i,{cross_subdomain:Ut.config.is_cross_subdomain})}}return o(e,[{key:"initStore",value:function(){var e=Ut.config.is_cross_subdomain,t=he(Nn),n="otrack_jssdk_is_first_day",r=he(n),i=new Date;i.setDate(i.getDate()+1),i.setHours(0,0,0,0),e?(ve(Nn,"",-1),ve(n,"",-1)):(ve(Nn,"",-1,{cross_subdomain:!0}),ve(n,"false",-1,{cross_subdomain:!0}));var o=he(Nn);null!=t&&null==o&&(ve(Nn,t,73e3,{cross_subdomain:e}),r&&ve(n,r,i,{cross_subdomain:e}))}},{key:"getCustomHead",value:function(){return this.customAttrs||{}}},{key:"getDeviceId",value:function(){return this.deviceId}},{key:"setCustomHead",value:function(e){if(j(e)){for(var t in e)null==e[t]&&(e[t]="");this.customAttrs=e}else ie.error("registerGlobalAttrs的参数必须是属性")}},{key:"setAppVersion",value:function(e){this.appVersion=e||""}},{key:"getAppVersion",value:function(){return this.appVersion||""}},{key:"setUserId",value:function(e){this.userId=e||"",ie.info("".concat((new Date).toLocaleString()," setUserId: ").concat(this.userId)),this.writeStore()}},{key:"setIsWebview",value:function(e){this.isWebview=!!e}},{key:"getIsWebview",value:function(){return this.isWebview}},{key:"getUserId",value:function(){return this.userId}},{key:"writeStore",value:function(){ve(Nn,dt(fe({deviceId:this.deviceId,userId:this.userId})),73e3,{cross_subdomain:Ut.config.is_cross_subdomain})}},{key:"isFirstDayFromCookies",value:function(){var e=this.isFirstDay&&de(he("otrack_jssdk_is_first_day")||"null");return!e&&this.isFirstDay&&(this.isFirstDay=!1),e}}]),e}(),Pn=ie.clone({namespace:"对账数据",isShowLog:!1}),Mn=function(e){s(n,e);var t=v(n);function n(){var e;r(this,n);for(var i=arguments.length,o=Array(i),a=0;i>a;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).memoryCache={events:[],posts:[]},e.timerMap={events:0,posts:0},e.totalCreate=0,e.reportTotalCreate=[0,0],e}return o(n,[{key:"registerCreate",value:function(e,t){this.memoryCache.events.push(e),this.memoryCache.events.length>20&&(this.timerMap.events=window.setTimeout(this.registerMemoCb.bind(this),0)),0===this.timerMap.events&&(this.timerMap.events=window.setTimeout(this.registerMemoCb.bind(this),50))}},{key:"registerUpload",value:function(e,t){this.register(e,1,t)}},{key:"registerMemoCb",value:function(e){this.register(this.memoryCache.events,0,e),this.memoryCache.events=[],window.clearTimeout(this.timerMap.events),this.timerMap.events=0}},{key:"register",value:function(e,t,n){var r=this;if(e){var i={},o=0===t?"event_count":"post_count";(e&&M(e)?e:[e]).map((function(e,t){return 60*Math.floor(+e.$event_time/6e4)*1e3})).forEach((function(e){0===t&&(r.totalCreate+=1),i[e]=i[e]?i[e]+1:1})),this.reportTotalCreate[t]+=Object.keys(i).reduce((function(e,t){return e+i[t]}),0),Pn.debug("[对账调试]对账数据产生内存统计",o,this.reportTotalCreate);var a=this.writeTypeStgSafe(T.BALANCE,(function(e){for(var t in Pn.debug("[对账调试]写入前",e),Pn.debug("[对账调试]写入中",o,i),i)i.hasOwnProperty(t)&&(e[t]=e[t]||{sequence_id:_e(),event_count:0,post_count:0},e[t][o]+=i[t]);return e}));Pn.debug("[对账调试]写入后",a)}}}]),n}(Ln),Rn=function(){function e(){r(this,e)}return o(e,null,[{key:"userInfo",get:function(){return this._userInfoInst||(this._userInfoInst=new jn),this._userInfoInst}},{key:"trackBalanceCreate",get:function(){return this._balanceGenInst||(this._balanceGenInst=new Mn),this._balanceGenInst}}]),e}();Rn._userInfoInst=void 0,Rn._balanceGenInst=void 0;var Un,$n=function(){function e(){var t=this;r(this,e),this.spanConf={life:864e5,renewal:18e5,cookieUpdateInterval:6e4},this.cookieNameConst=void 0,this.sessionMeta=void 0,this.cookieUpdatedTime=0,this.sessionMeta={id:"",createTime:0,renewalTime:0},this.cookieNameConst="obus-track_"+Ut.config.app_id+"_session",this.spanConf.renewal=6e4*Ut.config.session_cutting_time,this.sessionMeta.id||this.restoreSession(),$.addEvent(window,"beforeunload",(function(){t.persist()})),$.addEvent(window,"unload",(function(){t.persist()}))}return o(e,[{key:"update",value:function(){var e=Date.now();e-this.sessionMeta.createTime>this.spanConf.life||e-this.sessionMeta.renewalTime>this.spanConf.renewal||""==this.sessionMeta.id?this.renew():this.cookieUpdatedTime&&this.spanConf.cookieUpdateInterval>=e-this.cookieUpdatedTime||(this.sessionMeta.renewalTime=e,this.setCookies())}},{key:"getSessionId",value:function(){return this.sessionMeta.id}},{key:"restoreSession",value:function(){var e=he(this.cookieNameConst);if(e)this.restoreSessionWithData(e);else{var t=me(this.cookieNameConst);t&&this.restoreSessionWithData(t)}this.sessionMeta.id||this.renew()}},{key:"restoreSessionWithData",value:function(e){var t=e.split(",");t.length>0&&(this.sessionMeta.id=t[0]);try{t.length>1&&(this.sessionMeta.createTime=+new Date(+t[1]),this.sessionMeta.createTime=this.sessionMeta.createTime>0?this.sessionMeta.createTime:0),t.length>2&&(this.sessionMeta.renewalTime=+new Date(+t[2]),this.sessionMeta.renewalTime=this.sessionMeta.renewalTime>0?this.sessionMeta.renewalTime:0)}catch(e){console.log("otrack 日期初始化异常")}}},{key:"renew",value:function(){this.sessionMeta={id:ce(),createTime:Date.now(),renewalTime:Date.now()},this.setCookies()}},{key:"setCookies",value:function(){var e=this.sessionMeta,t=e.createTime+this.spanConf.life,n=e.renewalTime+this.spanConf.renewal,r=t>n?n:t;ve(this.cookieNameConst,[e.id,e.createTime,e.renewalTime].join(","),new Date(r),{cross_subdomain:Ut.config.is_cross_subdomain}),this.cookieUpdatedTime=Date.now()}},{key:"persist",value:function(){var e=this.sessionMeta;me(this.cookieNameConst,[e.id,e.createTime,e.renewalTime].join(","))}}]),e}(),Hn=function(){function e(){r(this,e),this.session=void 0,this.session=new $n}return o(e,[{key:"getHeader",value:function(){var e,r=Rn.userInfo,i={$platform:"web",$lib_version:(null===(e=Ut.getPkgInfo())||void 0===e?void 0:e.version)||"",$lib_type:"object"===("undefined"==typeof exports?"undefined":n(exports))&&"undefined"!=typeof module?"npm":"script",$timezone_offset:(new Date).getTimezoneOffset(),$screen_height:Number(screen.height)||0,$screen_width:Number(screen.width)||0,$orientation:je,$doc_width:Le,$doc_height:Ne,$connection_type:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&e.effectiveType||""},$browser_type:Fe.type,$browser_version:Fe.versions,$os:qe+","+(r.getIsWebview()?"webview":De.device),$session_id:this.session.getSessionId(),$browser_language:navigator.language||navigator.userLanguage||""},o={$region:function(){return Ut.config.region},$device_id:function(){return Rn.userInfo.deviceId},$user_id:r.getUserId.bind(r),$app_version:r.getAppVersion.bind(r)},s=t(t({},i),o),c=Object.create(null);return Object.keys(s).forEach((function(e){var t=s[e];Object.assign(c,a({},e,"function"==typeof t?t():t))})),this.session.update(),c}}]),e}(),Fn=["head","pending"],qn=function(e){s(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this)).isSending=!1,t.continueFailCount=0,t.failIgnoreList=[],t.identity=void 0,t.logId="",t.options=void 0,t.url="",t.reportHeader=void 0,t.options=e,t.identity=e.identity,t.reportHeader=new Hn,t.consumeStart(!0),t}return o(i,[{key:"consumeStart",value:function(e,t){this.consumeStart=Ee(this.consumeStartOrg.bind(this),100),this.consumeStart(e,t)}},{key:"consumeStartOrg",value:function(e,t){var n,r=this.readTypeStg(this.options.queue);if(!r||0===(null==r||null===(n=r.data)||void 0===n?void 0:n.length)||this.isSending)return!1;this.logId=t||"",this.isSending=!0,this.startTask(e,0)}},{key:"startTask",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.readTypeStg(this.options.queue),o=i.data.filter((function(e){return!n.failIgnoreList.includes(n.identity(e))})).filter((function(t){return e||1!==t.pending})),a=o.shift();if(!(a&&Object.keys(a).length&&(a.body.length||Object.keys(a.body).length)&&this.isSending&&5>r))return this.stopTask();this.continueFailCount++;var s=Date.now(),c=this.getRequestData(a),u=c.head,f=l(c,Fn),d=pt(t({head:u},f));this.setItemStatus(c,1),Ie(this.url+"?app_key=".concat(Ut.config.app_key,"&timestamp=").concat(s),t(t({},d),{},{method:"POST",timeout:Ut.config.fail_timeout,reTryCount:Ut.config.fail_retry_count,success:function(){n.success&&n.success(c),n.cleanDb(c),n.startTask(e,0)},fail:function(t,i){switch(t=t||"",+((i=i||999)||999)){case 442:case 435:n.cleanDb(c),n.logger.error(n.logId,"原因: ".concat(t,", code: ").concat(i," 处于[442, 435], 上报失败本地删除数据"),f);break;case 999:n.logger.error(n.logId,"原因: ".concat(t,", code: ").concat(i," 不处于[442, 435], 上报失败本地不删除数据"),f),n.setItemStatus(c,0),n.failIgnoreList.push(n.identity(c));break;default:(Oe()||408!=i)&&n.logger.error(n.logId,"上报失败，原因: ".concat(t,", code: ").concat(i),f),n.setItemStatus(c,0)}n.startTask(e,++r)}}))}},{key:"stopTask",value:function(){return this.isSending=!1,this.continueFailCount=0,this.failIgnoreList=[],this.options.consumeEnd&&this.options.consumeEnd(),!1}},{key:"cleanDb",value:function(e){var t=this;this.writeTypeStgSafe(this.options.queue,(function(n){var r=n.filter((function(n){return t.identity(e)!==t.identity(n)}));return r.length!==n.length&&r}))}},{key:"setItemStatus",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.writeTypeStgSafe(this.options.queue,(function(i){var o=i.map((function(i){return n.identity(e)===n.identity(i)?t(t({},i),{},{pending:r}):i}));return o.length>0&&o}))}},{key:"sendBeacon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isSending=!0,this.startTask(e,t)}}]),i}(Ln),Gn=["head"],Wn=function(e){s(i,e);var n=v(i);function i(){var e;return r(this,i),(e=n.call(this,{queue:T.BALANCE_REQ,identity:function(e){return e.request_id}})).logger=ie.clone({namespace:"对账上报",isShowLog:!0,isShowMills:!1}),e.url=gt("$HOST/v3/balance/js/$APPID",Ut.uploadHost,Ut.config.app_id),e}return o(i,[{key:"getRequestData",value:function(e){return e.body.eventCompleteness=fe(e.body.eventCompleteness),t(t({},e),{},{head:this.reportHeader.getHeader(),custom_head:Rn.userInfo.getCustomHead()})}},{key:"success",value:function(e){var t=l(e,Gn);this.logger.debug("上报成功",Ut.config.is_print_header?e:t)}},{key:"report",value:function(){var e=this.readTypeStg(T.BALANCE),t=Object.keys(e.data).sort((function(e,t){return+e-+t}));if(0>=t.length)return!1;this.writeTypeStgMultiSafe([T.BALANCE,T.BALANCE_REQ],(function(e,t){if(!e||!Object.keys(e).length)return!1;var n={request_id:ce(),body:{eventCompleteness:e}};return t.push(n),[{},t]})),this.consumeStart(!1)}}]),i}(qn),Vn=["head"],Bn=function(e){s(i,e);var n=v(i);function i(){var e;r(this,i);var t=0,o=0;return(e=n.call(this,{queue:k.REQUEST,consumeEnd:function(){var n;(t&&(window.clearTimeout(t),t=0),"number"==typeof Ut.config.balance_stats_interval&&Ut.config.balance_stats_interval)?(o&&(window.clearTimeout(o),o=0),t=window.setTimeout((function(){e.writeTypeStg(k.TRACK_PENDING,{data:[],version:Date.now()})}),1e3*Ut.config.balance_stats_interval+2e3),o=window.setTimeout((function(){var t;null===(t=e.balanceReport)||void 0===t||t.report()}),1e3*Ut.config.balance_stats_interval)):(t=window.setTimeout((function(){e.writeTypeStg(k.TRACK_PENDING,{data:[],version:Date.now()})}),2e3),null===(n=e.balanceReport)||void 0===n||n.report())},identity:function(e){return e.request_id}})).balanceReport=void 0,e.url="",e.logger=ie.clone({namespace:"埋点上报",isShowLog:!0,isShowMills:!1}),e.url=gt("$HOST/v3/track/js/$APPID",Ut.uploadHost,Ut.config.app_id),Ut.config.balance&&(e.balanceReport=new Wn),e}return o(i,[{key:"getRequestData",value:function(e){return t(t({},e),{},{head:this.reportHeader.getHeader(),custom_head:Rn.userInfo.getCustomHead()})}},{key:"success",value:function(e){l(e,Vn);this.logger.info("上报成功",e.body.map((function(e){return e.$sequence_id}))),Rn.userInfo.isFirstTime=!1,Rn.trackBalanceCreate.registerUpload(e.body,this.logId)}}]),i}(qn),Qn=["browser_type","browser_version"],Kn=function(e,t,n){var r=function(e){var t={};return Object.keys(e).forEach((function(n){var r=0===n.indexOf("$")?n.replace("$",""):n;t[r]=e[n]})),t},i={head:l(r(e),Qn),body:function(e){return Array.isArray(e)?e.map((function(e){return r(e)})):[r(e)]}(t),custom_head:r(n)};return i},zn=function(){return ce(4,{letters:!1})},Jn=!1,Xn=function(e){s(a,e);var i=v(a);function a(){var e,t,n;return r(this,a),(n=i.call(this)).durationEventMap={},n.batchSend=void 0,n.trackTimer=0,n.logId=zn(),n.consumeTrackCount=0,n.customPropertiesAttach=function(){return{}},n.headInfo=null===(e=new Bn)||void 0===e||null===(t=e.balanceReport)||void 0===t?void 0:t.reportHeader.getHeader(),n.browserInfo=function(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n=function(t){return(""+e.match(t)).replace(/[^0-9|_.]/g,"").replace(/_/g,".")},r="unknow";t(/windows|win32|win64|wow32|wow64/g)?r="windows":t(/macintosh|macintel/g)?r="macos":t(/x11/g)?r="linux":t(/android|adr/g)?r="android":t(/ios|iphone|ipad|ipod|iwatch/g)&&(r="ios");var i="unknow";"windows"===r?t(/windows nt 5.0|windows 2000/g)?i="2000":t(/windows nt 5.1|windows xp/g)?i="xp":t(/windows nt 5.2|windows 2003/g)?i="2003":t(/windows nt 6.0|windows vista/g)?i="vista":t(/windows nt 6.1|windows 7/g)?i="7":t(/windows nt 6.2|windows 8/g)?i="8":t(/windows nt 6.3|windows 8.1/g)?i="8.1":t(/windows nt 10.0|windows 10/g)&&(i="10"):"macos"===r?i=n(/os x [\d._]+/g):"android"===r?i=n(/android [\d._]+/g):"ios"===r&&(i=n(/os [\d._]+/g));var o="unknow";"windows"===r||"macos"===r||"linux"===r?o="desktop":("android"===r||"ios"===r||t(/mobile/g))&&(o="mobile");var a="unknow",s="unknow";t(/applewebkit/g)?(a="webkit",t(/edge/g)?s="edge":t(/opr/g)?s="opera":t(/chrome/g)?s="chrome":t(/safari/g)&&(s="safari")):t(/gecko/g)&&t(/firefox/g)?(a="gecko",s="firefox"):t(/presto/g)?(a="presto",s="opera"):t(/trident|compatible|msie/g)&&(a="trident",s="iexplore");var c="unknow";"webkit"===a?c=n(/applewebkit\/[\d._]+/g):"gecko"===a?c=n(/gecko\/[\d._]+/g):"presto"===a?c=n(/presto\/[\d._]+/g):"trident"===a&&(c=n(/trident\/[\d._]+/g));var u="unknow";"chrome"===s?u=n(/chrome\/[\d._]+/g):"safari"===s?u=n(/version\/[\d._]+/g):"firefox"===s?u=n(/firefox\/[\d._]+/g):"opera"===s?u=n(/opr\/[\d._]+/g):"iexplore"===s?u=n(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===s&&(u=n(/edge\/[\d._]+/g));var l="none",f="unknow";return t(/micromessenger/g)?(l="wechat",f=n(/micromessenger\/[\d._]+/g)):t(/qqbrowser/g)?(l="qq",f=n(/qqbrowser\/[\d._]+/g)):t(/ucbrowser/g)?(l="uc",f=n(/ucbrowser\/[\d._]+/g)):t(/qihu 360se/g)?l="360":t(/2345explorer/g)?(l="2345",f=n(/2345explorer\/[\d._]+/g)):t(/metasr/g)?l="sougou":t(/lbbrowser/g)?l="liebao":t(/maxthon/g)&&(l="maxthon",f=n(/maxthon\/[\d._]+/g)),Object.assign({engine:a,engineVs:c,platform:o,supporter:s,supporterVs:u,system:r,systemVs:i},"none"===l?{}:{shell:l,shellVs:f})}(),n.flush=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var c=function(){var t;s=!1===(null===(t=n)||void 0===t?void 0:t.leading)?0:Date.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){var u,l,f=Date.now();s||!1!==(null===(u=n)||void 0===u?void 0:u.leading)||(s=f);var d=t-(f-s);return r=this,i=arguments,0>=d||d>t?(a&&(clearTimeout(a),a=null),s=f,o=e.apply(r,i),a||(r=i=null)):a||!1===(null===(l=n)||void 0===l?void 0:l.trailing)||(a=setTimeout(c,d)),o}}((function(){return!Ut.isReady()&&(!!Ut.config.flush&&void n.pickEventQToReqQ(2))}),2e3,{leading:!0}),Ut.registerCallbacks((function(e){var t,r,i,o=n.readTypeStg(k.DEFERRED);(n.batchSend=new Bn,e.app_version&&Rn.userInfo.setAppVersion(""+e.app_version||""),ie.info(e.app_id+" 当前环境: ".concat(e.env||"prod"),"设备ID: ".concat(null===(t=Rn.userInfo)||void 0===t?void 0:t.deviceId)),e.is_print_header)&&ie.info("公共头",null===(r=n.batchSend)||void 0===r||null===(i=r.balanceReport)||void 0===i?void 0:i.reportHeader.getHeader());o.data.length&&(n.readTypeStg(k.DEFERRED).data.forEach((function(e){var t,r=g(t=e)||m(t)||y(t)||_(),i=r[0],o=r.slice(1);-1!==["track"].indexOf(i)&&n[i].apply(f(n),o)})),n.writeTypeStgSafe(k.DEFERRED,(function(){return[]}))),n.pickEventQToReqQOriginal(3)})),Jn||(Jn=!0,$.addEvent(window,"beforeunload",(function(){var e;Oe(!1),null===(e=n.batchSend)||void 0===e||e.sendBeacon(!0)})),$.addEvent(window,"unload",(function(){var e;Oe(!1),null===(e=n.batchSend)||void 0===e||e.sendBeacon(!0)}))),n}return o(a,[{key:"track",value:function(e,r){var i,o,a,s,c=arguments,u=Ut.config.pageview.url_alias,l=Ut.config.reported_platforms,f={};if(this.logId=zn(),e.eventId)if(e.eventGroup)if(e.properties=e.properties||{},A.eventId!==e.eventId?(f.$title=e.title||u[location.pathname||"/"]||document.title,f.$referrer=ft.getPrevUrl(),f.$url=document.URL||document.documentURI||location.href||"",f.$url_path=location.pathname||"/"+f.$url.replace(/(#.*)/,"").split("/").slice(3).join("/")):(f.$title=e.title,f.$referrer=e.referrer,f.$url=e.url,f.$url_path=e.url_path),I.eventId===e.eventId&&(f.$is_first_day=e.is_first_day,f.$is_first_time=e.is_first_time),Ut.isReady()){var d=Ut.config,v=d.event_rule,p=d.event_blacklist,g=Mt(e,{event_rule:v,event_blacklist:p});if(g)ie.warn("事件被过滤",e);else{e.properties=t(t({},e.properties),this.customPropertiesAttach());var m=t(t({},f),{},{$event_id:e.eventId,$event_group:e.eventGroup,$event_info:JSON.stringify(e.properties),$event_time:0===e.eventId.indexOf("$")&&e.properties.$visit_time?e.properties.$visit_time:Date.now(),$sequence_id:_e()});ie.info(this.logId,"埋点产生",m,n(m));var y=(null===(i=window)||void 0===i||null===(o=i.App_AutoEvent_Js_Bridge)||void 0===o?void 0:o.track)||(null===(a=window)||void 0===a||null===(s=a.App_Js_Bridge)||void 0===s?void 0:s.track);if(!l.includes("web")||y){var w=Kn(this.headInfo,m,Rn.userInfo.getCustomHead());console.log("params-a",w),l.includes("app")&&y?0!==(null==m?void 0:m.$event_id.indexOf("$"))?window.App_Js_Bridge.track(JSON.stringify(w)):window.App_AutoEvent_Js_Bridge.track(JSON.stringify(w)):ie.info("未配置app上报或H5不在app中访问")}else this.pushTrackQueue(k.TRACK,m,r)}}else this.writeTypeStgSafe(k.DEFERRED,(function(e){return e.push(["track"].concat(h([].slice.call(c)))),e}));else ie.error("track方法事件模块必填");else ie.error("track方法eventId不能为空")}},{key:"startEvent",value:function(e,t){if(this.durationEventMap["".concat(e,"-").concat(t)])return ie.warn("event id: ".concat(e,", event group: ").concat(t," 已经start")),!1;ie.info("startEvent event id: ".concat(e,", event group: ").concat(t)),this.durationEventMap["".concat(e,"-").concat(t)]=(new Date).getTime()}},{key:"stopEvent",value:function(e,t,n){if(!this.durationEventMap["".concat(e,"-").concat(t)])return ie.warn("event id: ".concat(e,", event group: ").concat(t," 未开始")),!1;ie.info("Stop event id: ".concat(e,", event group: ").concat(t,", props: "),n),n.$duration=(new Date).getTime()-this.durationEventMap["".concat(e,"-").concat(t)],delete this.durationEventMap["".concat(e,"-").concat(t)],this.track({eventId:e,eventGroup:t,properties:n})}},{key:"pushTrackQueue",value:function(e,t,n){var r=this;if(-1===O.indexOf(e))return ie.warn(this.logId,"未知的事件类型 type: ".concat(e)),!1;Rn.trackBalanceCreate.registerCreate(t,this.logId);var i=this.writeTypeStgSafe(e,(function(e){return e.every((function(e){return e.$sequence_id!==t.$sequence_id}))&&e.push(t),e}));return Ut.config.fast?(this.pickEventQToReqQ(2),void(n&&n(this))):n?(this.pickEventQToReqQ(2),void n(this)):(Ut.config.max_batch_events>i.length||setTimeout((function(){r.pickEventQToReqQ(0),window.clearTimeout(r.trackTimer),r.trackTimer=0}),30*Math.random()),void(0===this.trackTimer&&(this.trackTimer=window.setTimeout((function(){r.pickEventQToReqQ(1),r.trackTimer=0}),1e3*Ut.config.interval_time))))}},{key:"pickEventQToReqQ",value:function(e){return Ee(this.pickEventQToReqQOriginal.bind(this),100)(e)}},{key:"pickEventQToReqQOriginal",value:function(e){var t,n=this,r=Ut.config.max_batch_events;4!==e&&(this.consumeTrackCount=0);this.writeTypeStgMultiSafe([k.TRACK,k.REQUEST],(function(e,t){if(!e||!e.length)return!1;var i=n.readTypeStg(k.TRACK_PENDING),o=e.slice(0,r).filter((function(e){return!i.data.includes(e.$sequence_id)}));n.writeTypeStgSafe(k.TRACK_PENDING,(function(e){return 0!==(null==o?void 0:o.length)&&(o.forEach((function(t){e.includes(t.$sequence_id)||e.push(t.$sequence_id)})),e.slice(-50))}));var a=e.filter((function(e){return o.every((function(t){return t.$sequence_id!==e.$sequence_id&&!i.data.includes(e.$sequence_id)}))}));if(o&&o.length>0){var s={request_id:ce(),body:o};t.push(s)}return[a,t]}));for(var i=this.readTypeStg(k.TRACK);i.data.length>=Ut.config.max_batch_events&&1e3>this.consumeTrackCount;)this.consumeTrackCount++,this.pickEventQToReqQOriginal(4);null===(t=this.batchSend)||void 0===t||t.consumeStart(!1,this.logId)}},{key:"setCustomProperties",value:function(e){this.customPropertiesAttach="object"===n(e)?function(){return e}:e}}]),a}(Ln),Yn={url:"",url_path:"",title:"",referrer:"",event_info:null,_storeDuration:0,_lastViewTime:0},Zn="prev_visit_page";!function(e){e[e.DURATION=0]="DURATION",e[e.PAGE_VIEW=1]="PAGE_VIEW"}(Un||(Un={}));var er=function(){function e(n){var i=this;r(this,e),this.trackTime=!1,this.inactivityCounter=0,this.inactivityTime=15,this.getAutoTrackParams=null,this.pageDuration=Yn,this.trackDispatch=void 0,this.logger=new re({namespace:"page_visit"});var o=Ut.config;this.trackDispatch=n||function(){},this.pageDuration=t(t({},Yn),we(Zn)),this.pageDuration._lastViewTime>0&&this.toTrackQueue(Un.DURATION,this.pageDuration,!0),this.startCounter(),"auto"===o.pageview.track_pageview_type.toLocaleLowerCase()&&o.is_single_page_app&&ft.push((function(e,t){t&&t.href===e.href||setTimeout((function(){i.trackPageView()}),o.pageview.delay)})),setTimeout((function(){i.trackPageView(o.pageview.is_trigger_pageload&&!o.pageview.track_ignore(location))}),o.pageview.delay)}return o(e,[{key:"trackPageView",value:function(e){var n={};void 0===e&&(e=!0),this.getAutoTrackParams&&R(this.getAutoTrackParams)&&(n=this.getAutoTrackParams()),this.pageDuration&&this.toTrackQueue(Un.DURATION,this.pageDuration,!1);var r=ce(6),i=Date.now(),o={url:window.location.href||"/",url_path:window.location.pathname||"/",title:Ut.config.pageview.url_alias[location.pathname||"/"]||document.title,referrer:ft.getPrevUrl(),event_info:t(t({},n),{},{$visit_id:r,$visit_time:i}),_lastViewTime:be()};this.storeSession(o),!Ut.config.pageview.track_ignore(location)&&e&&this.toTrackQueue(Un.PAGE_VIEW,t(t({},n),{},{$visit_id:r,$visit_time:i}))}},{key:"startCounter",value:function(){var e=this,t="hidden";this.startTime();var n=function(){document[t]?e.stopTime():e.startTime()};t in document?document.addEventListener("visibilitychange",n):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(t="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?($.addEvent(window,"focusin",(function(){e.startTime()})),$.addEvent(window,"focusout",(function(){e.stopTime()}))):($.addEvent(window,"focus",(function(){e.startTime()})),$.addEvent(window,"blur",(function(){e.stopTime()})),$.addEvent(window,"pageshow",(function(){e.startTime()})),$.addEvent(window,"pagehide",(function(){e.stopTime()})));var r=function(){e.inactivityTime>e.inactivityCounter||e.startTime(),e.inactivityCounter=0};$.addEvent(window,"mousemove",r),$.addEvent(window,"click",r),$.addEvent(window,"keydown",r),$.addEvent(window,"scroll",r),$.addEvent(window,"beforeunload",(function(){e.stopTime()})),$.addEvent(window,"unload",(function(){e.stopTime()})),setInterval((function(){e.inactivityCounter++,e.inactivityTime>e.inactivityCounter||e.stopTime()}),6e4)}},{key:"startTime",value:function(){this.trackTime||(this.trackTime=!0,this.pageDuration._lastViewTime=be()-this.pageDuration._storeDuration,this.pageDuration._storeDuration=0,this.storeSession({_storeDuration:this.pageDuration._storeDuration,_lastViewTime:this.pageDuration._lastViewTime}))}},{key:"stopTime",value:function(){this.trackTime&&(this.trackTime=!1,this.pageDuration._storeDuration=be()-this.pageDuration._lastViewTime,this.storeSession({_storeDuration:this.pageDuration._storeDuration}))}},{key:"setAutoTrackParam",value:function(e){var t=e;"object"===n(e)&&(t=function(){return e}),this.getAutoTrackParams=t}},{key:"toTrackQueue",value:function(e,r,i){if(e===Un.DURATION){var o=0;if(i||this.trackTime?o=0!==this.pageDuration._storeDuration?this.pageDuration._storeDuration:be()-this.pageDuration._lastViewTime:this.trackTime||(o=this.pageDuration._storeDuration),o>0&&""!==this.pageDuration.url&&Ut.config.is_track_visittime){var a=r||{},s=a.event_info,c=a.url,u=a.url_path,l=a.title,f=a.referrer;this.trackDispatch(t(t({},A),{},{url:c,url_path:u,title:l,referrer:f,properties:t({duration:o},s)}))}return this.pageDuration=t({},Yn),this.storeSession(null),!0}this.trackDispatch(t(t({},I),{},{properties:t({},"object"===n(r)?r:null),is_first_day:Rn.userInfo.isFirstDayFromCookies(),is_first_time:Rn.userInfo.isFirstTime}))}},{key:"storeSession",value:function(e){if(null==e)return we(Zn,null);this.pageDuration=t(t(t({},Yn),this.pageDuration),e),this.pageDuration.referrer||(this.pageDuration.referrer=ft.getPrevUrl()),we(Zn,this.pageDuration)}}]),e}(),tr="1.5.9";new Promise((function(e){if(!(null==Array?void 0:Array.prototype.includes)||!(null==Object?void 0:Object.keys)){var t=document.createElement("script");t.onload=function(){e(!0)},document.head.appendChild(t),t.setAttribute("async","async"),t.setAttribute("src",vt("polyfill.umd.min.js"))}})),Ut.setPkgInfo({name:"@oplus/obus-track-sdk",version:tr});var nr=["track","startEvent","stopEvent","flush","setCustomProperties"],rr=["setCustomHead","getCustomHead","getDeviceId","setAppVersion","getAppVersion","setUserId","getUserId","setCustomClientId","getCustomClientId","isFirstDayFromCookies","setIsWebview","getIsWebview"];function ir(e){var t=this;if(e){for(var n=e.split("."),r=n[n.length-1],i=0;n.length-1>i&&null!=(t=t[n[i]]);i++);if(null!=t){if(t&&"function"==typeof t[r]){for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;o>s;s++)a[s-1]=arguments[s];return t[r].apply(t,a)}return t[r]}}else ie.error("".concat(e," 不能为空"))}var or=function(){function e(t){var n=this;r(this,e),this.trackEvent=void 0,this.dispatch=function(e){Ut.config.sdk_auto_track&&n.trackEvent.track(e)},Ut.init(t,this);var i=this.trackEvent=new Xn;rr.forEach((function(e){n[e]=function(){return ir.apply(Rn.userInfo,[e].concat(Array.prototype.slice.call(arguments)))}})),nr.forEach((function(e){n[e]=function(){return ir.apply(i,[e].concat(Array.prototype.slice.call(arguments)))}})),this.getHeader=function(){return ir.apply(i,["batchSend.reportHeader.getHeader"].concat(Array.prototype.slice.call(arguments)))},this.updateCloudConfig=function(e){return ir.call(i,"cloudAppConfig.refresh",!0,(function(){(null==e||e)&&window.location.reload()}))};var o=new er(this.dispatch);this.setAutoTrackParam=o.setAutoTrackParam.bind(o),this.trackPageView=o.trackPageView.bind(o)}return o(e,[{key:"options",get:function(){return Ut.config}}],[{key:"VERSION",get:function(){return tr}}]),e}();or.CLOUD_VERSION=At.VERSION;var ar="data-exposure-id",sr=function(){function e(n){r(this,e),this.observeNodeList=[],this.options=void 0,this.observer=null,this.durationTimer={},this.options=Object.assign(t(t({},Ut.config.exposure),{},{dispatch:n})),1>=this.options.intersection_threshold&&this.options.intersection_threshold>0||(this.options.intersection_threshold=1),(this.options.duration_threshold>3e3||0>this.options.duration_threshold)&&(this.options.duration_threshold=0),this.init()}return o(e,[{key:"init",value:function(){var e=this;this.observer=new IntersectionObserver((function(t,n){t.forEach((function(t){var n=t.target,r=n.getAttribute(ar),i=e.observeNodeList.find((function(e){return e.el===n}));if(r&&i)if(t.isIntersecting&&t.intersectionRatio>=e.options.intersection_threshold){if(e.durationTimer[r]&&0!==e.durationTimer[r])return;e.durationTimer[r]=window.setTimeout((function(){var t=Qe(!0,{properties:Cn(n)},i.data);e.options.dispatch(t),e.options.once?e.unobserve(n):e.clean(n)}),e.options.duration_threshold)}else e.durationTimer[r]&&e.clean(n)}))}),{root:null,rootMargin:this.options.root_margin,threshold:this.options.intersection_threshold})}},{key:"observe",value:function(e,t){e.getAttribute(ar)||e.setAttribute(ar,ce(8)),this.observeNodeList.find((function(t){return t.el===e}))||(this.observeNodeList.push({el:e,data:t}),this.observer&&this.observer.observe(e))}},{key:"unobserve",value:function(e){var t;this.clean(e),this.observeNodeList=this.observeNodeList.filter((function(t){return t.el!==e})),null===(t=this.observer)||void 0===t||t.unobserve(e)}},{key:"clean",value:function(e){var t=e.getAttribute(ar);t&&(window.clearTimeout(this.durationTimer[t]),delete this.durationTimer[t])}}]),e}();!function(){if("object"!==("undefined"==typeof __wxConfig?"undefined":n(__wxConfig)))return new Promise((function(e){var t;if(!("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in(null===(t=window)||void 0===t?void 0:t.IntersectionObserverEntry.prototype))){var n,r=null===(n=document)||void 0===n?void 0:n.createElement("script");r.onload=function(){e(!0)},document.head.appendChild(r),r.setAttribute("async","async"),r.setAttribute("src",vt("IntersectionObserver.min.js"))}}));console.log("wx",__wxConfig,"__wxConfig 在index.ts")}();var cr=function(e){s(i,e);var n=v(i);function i(e){var o;r(this,i);var a,s,c,u=(o=n.call(this,e)).dispatch,l=new sr(u);return o.exposure={observe:l.observe.bind(l),unobserve:l.unobserve.bind(l)},An({logger:ie.clone({namespace:"heatmap"}),heatmap:Ut.config.heatmap,dispatch:u}),o.heatmap={trackHeatMap:Sn.trackHeatMap.bind(Sn),trackAllHeatMap:Sn.trackAllHeatMap.bind(Sn)},yn(u),a=function(e){u(t(t({},x),{},{properties:e}))},s=function(){return Ut.config.develop.catch_js_error},c=window.onerror,window.onerror=function(e,t,n,r,i){var o=e;if(!s())return!1;i&&i.stack&&(o=$t(i)),a({msg:o,target:t,rowNum:n,colNum:r,orgMsg:e,level:4}),c&&c.apply(window,arguments)},window.addEventListener("unhandledrejection",(function(e){if(e.preventDefault(),!s())return!1;var t=e.reason;if(e&&e.reason&&"Object"===U(e.reason))try{t=JSON.stringify(e.reason),console.error(t)}catch(e){console.error("[oReport] stringify error"),console.error(e)}a({msg:t||"unhandledrejection",target:"unhandledrejection",rowNum:0,colNum:0,level:4})})),o.getEleDetail=Cn,o}return o(i)}(or);return cr}));
